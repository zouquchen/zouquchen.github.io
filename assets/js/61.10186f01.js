(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{385:function(t,s,a){"use strict";a.r(s);var n=a(8),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"内存泄漏与内存溢出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内存泄漏与内存溢出"}},[t._v("#")]),t._v(" 内存泄漏与内存溢出")]),t._v(" "),s("h4",{attrs:{id:"_1-什么是内存泄漏"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是内存泄漏"}},[t._v("#")]),t._v(" 1 什么是内存泄漏？")]),t._v(" "),s("p",[t._v("指一个不再被程序使用的对象或变量一致占据在内存中。")]),t._v(" "),s("p",[t._v("内存泄漏的情况1：程序员创建了一个对象，以后一直不再使用这个对象，这个对象却一直被引用，即这个对象无用但是却无法被垃圾回收器回收，这就是java中可能出现内存泄漏的情况。例如，缓存系统，我们加载了一个对象放在缓存中（例如放在全局map对象中），然后一直不再使用它，这个对象一直被缓存引用，但却不再被使用。")]),t._v(" "),s("p",[t._v("内存泄漏情况2：当一个对象被存进HashSet集合中，就不能修改这个对象中那些参与计算哈希值的字段。否则，修改后的哈希值与最初存储在HashSet集合中的哈希值不同，这种情况下，使用contains方法无法在HashSet中检索到对象，这也会导致无法从HashSet集合中单独删除当前对象，造成内存泄漏。")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MemoryLeakTest")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashMap")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" map "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashMap")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"abc"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\n        s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aaa"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// null")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("h4",{attrs:{id:"_2-什么是内存溢出-oom-哪些区域会oom"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-什么是内存溢出-oom-哪些区域会oom"}},[t._v("#")]),t._v(" 2 什么是内存溢出（OOM）？哪些区域会OOM？")]),t._v(" "),s("p",[t._v("指程序运行过程中无法申请到足够的内存而导致的一种错误。常见情况：OutOfMemeryError异常。")]),t._v(" "),s("ol",[s("li",[t._v("虚拟机栈和本地方法栈溢出\n"),s("ul",[s("li",[t._v("如果线程请求的栈深度大于虚拟机所允许的最大深度，将抛出StackOverflowError")]),t._v(" "),s("li",[t._v("如果虚拟机在扩展时无法申请到足够的内存空间，将抛出OutOfMemoryError")])])]),t._v(" "),s("li",[t._v("堆溢出\n"),s("ul",[s("li",[t._v("是否出现内存泄漏，可通过工具查看泄漏对象到GC ROots的引用链。")]),t._v(" "),s("li",[t._v("如果没有内存泄漏，查看虚拟机的参数（-Xmx于-Xms）的设置是否适当，")])])]),t._v(" "),s("li",[t._v("方法区溢出")]),t._v(" "),s("li",[t._v("运行时常量池溢出")])]),t._v(" "),s("h4",{attrs:{id:"_3-谈谈对oom的认识"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-谈谈对oom的认识"}},[t._v("#")]),t._v(" 3 谈谈对OOM的认识")]),t._v(" "),s("p",[t._v("OOM：OutOfMemeryError，是错误，不是异常")]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs2022/OOM-extends.png",alt:"image-20220621210931483"}}),t._v(" "),s("ul",[s("li",[t._v("java.lang.StackOverflowError——栈深度大于虚拟机所允许的最大深度，无限递归。")]),t._v(" "),s("li",[t._v("java.lang.OutOfMemoryError:  Java heap space——堆内存不够了")]),t._v(" "),s("li",[t._v("java.lang.OutOfMemoryError:  GC overhead limit exceeded——GC 的回收时间过程，超过 98% 的时间都用来 GC 且回收了不到 2% 的堆内存。")]),t._v(" "),s("li",[t._v("java.lang.OutOfMemoryError:  Direct buffer memory\n"),s("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs2022/OOM-Direct-buffer-memory.png",alt:"image-20220621212232555"}})]),t._v(" "),s("li",[t._v("java.lang.OutOfMemoryError:  unable to create new native thread\n"),s("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs2022/OOM-unable-to-create-new-native-thread.png",alt:"image-20220621212851031"}})]),t._v(" "),s("li",[t._v("java.lang.OutOfMemoryError:  Metaspace——元空间满了")])]),t._v(" "),s("h4",{attrs:{id:"_3-内存溢出的原因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-内存溢出的原因"}},[t._v("#")]),t._v(" 3 内存溢出的原因？")]),t._v(" "),s("ol",[s("li",[t._v("内存中加载的数据量过于庞大，如一次从数据库取出过多数据；")]),t._v(" "),s("li",[t._v("集合类中有对对象的引用，使用完后为清空，使得JVM不能回收；")]),t._v(" "),s("li",[t._v("代码中存在死循环或循环产生过多重复的对象实体。")]),t._v(" "),s("li",[t._v("启动参数内存值设定的过小。")])]),t._v(" "),s("h4",{attrs:{id:"_4-栈溢出的原因和解决办法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-栈溢出的原因和解决办法"}},[t._v("#")]),t._v(" 4 栈溢出的原因和解决办法？")]),t._v(" "),s("p",[t._v("原因：")]),t._v(" "),s("ol",[s("li",[t._v("大量的递归调用，在不断的压入栈帧，造成站容量超过内存而导致溢出。")]),t._v(" "),s("li",[t._v("由于分配了过大的局部变量。")])]),t._v(" "),s("p",[t._v("解决办法：")]),t._v(" "),s("ol",[s("li",[t._v("递归转化为非递归")]),t._v(" "),s("li",[t._v("使用静态对象替换非静态局部变量")]),t._v(" "),s("li",[t._v("增加栈堆的大小")])])])}),[],!1,null,null,null);s.default=e.exports}}]);