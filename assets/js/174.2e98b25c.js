(window.webpackJsonp=window.webpackJsonp||[]).push([[174],{503:function(t,s,_){"use strict";_.r(s);var a=_(8),e=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"lecture-校园讲座预约系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lecture-校园讲座预约系统"}},[t._v("#")]),t._v(" Lecture — 校园讲座预约系统")]),t._v(" "),s("p",[t._v("GitHub: "),s("a",{attrs:{href:"https://github.com/zouquchen/lecture-system",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/zouquchen/lecture-system"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"📚-1-项目简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📚-1-项目简介"}},[t._v("#")]),t._v(" 📚 1 项目简介")]),t._v(" "),s("p",[t._v("Lecture 是一款前后端分离的校园讲座预约系统，基于目前主流的技术栈（SpringBoot + MyBatis + MySQL + Redis + RabbitMQ + Spring Security + ...），现已支持面向管理员的讲座发布与修订，面向学生的讲座预约与取消等功能。")]),t._v(" "),s("h2",{attrs:{id:"📺-2-功能介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📺-2-功能介绍"}},[t._v("#")]),t._v(" 📺 2 功能介绍")]),t._v(" "),s("h3",{attrs:{id:"_2-1-测试账号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-测试账号"}},[t._v("#")]),t._v(" 2.1 测试账号")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("账号")]),t._v(" "),s("th",[t._v("密码")]),t._v(" "),s("th",[t._v("权限角色")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("admin")]),t._v(" "),s("td",[t._v("needoffer")]),t._v(" "),s("td",[t._v("admin，拥有所有权限（不包含预约讲座）")])]),t._v(" "),s("tr",[s("td",[t._v("manager")]),t._v(" "),s("td",[t._v("needoffer")]),t._v(" "),s("td",[t._v("manger，拥有发布和修改讲座等权限")])]),t._v(" "),s("tr",[s("td",[t._v("student0")]),t._v(" "),s("td",[t._v("needoffer")]),t._v(" "),s("td",[t._v("student，拥有预约讲座等权限")])]),t._v(" "),s("tr",[s("td",[t._v("student1")]),t._v(" "),s("td",[t._v("needoffer")]),t._v(" "),s("td",[t._v("student，拥有预约讲座等权限")])]),t._v(" "),s("tr",[s("td",[t._v("student2")]),t._v(" "),s("td",[t._v("needoffer")]),t._v(" "),s("td",[t._v("student，拥有预约讲座等权限")])]),t._v(" "),s("tr",[s("td",[t._v("student3")]),t._v(" "),s("td",[t._v("needoffer")]),t._v(" "),s("td",[t._v("student，拥有预约讲座等权限")])])])]),t._v(" "),s("h3",{attrs:{id:"_2-2-主要功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-主要功能"}},[t._v("#")]),t._v(" 2.2 主要功能")]),t._v(" "),s("ul",[s("li",[t._v("登录|登出")]),t._v(" "),s("li",[t._v("个人中心\n"),s("ul",[s("li",[t._v("修改个人信息")]),t._v(" "),s("li",[t._v("修改密码")]),t._v(" "),s("li",[t._v("查看讲座统计（总预约次数、未开始场次、出席次数、缺席次数）")])])]),t._v(" "),s("li",[t._v("关于\n"),s("ul",[s("li",[t._v("自定义显示 markdown 文件")])])]),t._v(" "),s("li",[t._v("讲座管理「admin权限」\n"),s("ul",[s("li",[t._v("分页条件查询讲座列表")]),t._v(" "),s("li",[t._v("讲座签到\n"),s("ul",[s("li",[t._v("根据用户名进行讲座签到")]),t._v(" "),s("li",[t._v("显示已签到用户")])])]),t._v(" "),s("li",[t._v("讲座详情查看\n"),s("ul",[s("li",[t._v("查看讲座详情")]),t._v(" "),s("li",[t._v("查看预约详情")]),t._v(" "),s("li",[t._v("评论或点赞内容")])])]),t._v(" "),s("li",[t._v("添加、修改或删除讲座")])])]),t._v(" "),s("li",[t._v("用户列表「admin权限」\n"),s("ul",[s("li",[t._v("分页条件查询用户")]),t._v(" "),s("li",[t._v("添加或删除用户")])])]),t._v(" "),s("li",[t._v("讲座预约「student权限」\n"),s("ul",[s("li",[t._v("查看讲座详情")]),t._v(" "),s("li",[t._v("预约或取消预约讲座")]),t._v(" "),s("li",[t._v("评论或点赞内容")]),t._v(" "),s("li",[t._v("查看我参与的讲座")])])]),t._v(" "),s("li",[t._v("消息通知\n"),s("ul",[s("li",[t._v("系统自动通知用户被评论或被点赞消息")])])]),t._v(" "),s("li",[t._v("其他\n"),s("ul",[s("li",[t._v("前后端的密码传输进行了加密、数据库中使用密文进行存储")]),t._v(" "),s("li",[t._v("前后端对填入数据的校验")])])])]),t._v(" "),s("h2",{attrs:{id:"💻-3-核心技术栈"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#💻-3-核心技术栈"}},[t._v("#")]),t._v(" 💻 3 核心技术栈")]),t._v(" "),s("p",[t._v("后端：")]),t._v(" "),s("ul",[s("li",[t._v("Spring")]),t._v(" "),s("li",[t._v("Spring MVC")]),t._v(" "),s("li",[t._v("Spring Boot 2.2.1.RELEASE")]),t._v(" "),s("li",[t._v("ORM：MyBatis")]),t._v(" "),s("li",[t._v("RPC：Dubbo 2.7.8")]),t._v(" "),s("li",[t._v("注册中心：Zookeeper")]),t._v(" "),s("li",[t._v("数据库：MySQL 8.0")]),t._v(" "),s("li",[t._v("缓存：Redis")]),t._v(" "),s("li",[t._v("消息队列：RabbitMQ")]),t._v(" "),s("li",[t._v("权限：Spring Security")])]),t._v(" "),s("p",[t._v("前端：")]),t._v(" "),s("ul",[s("li",[t._v("Vue 2.6.10")]),t._v(" "),s("li",[t._v("Node 16.15.0")]),t._v(" "),s("li",[t._v("模板："),s("a",{attrs:{href:"https://github.com/PanJiaChen/vue-admin-template",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-admin-template"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("样式："),s("a",{attrs:{href:"https://element.eleme.cn/#/zh-CN",target:"_blank",rel:"noopener noreferrer"}},[t._v("element-ui@2.15.7"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"🔨-4-开发环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🔨-4-开发环境"}},[t._v("#")]),t._v(" 🔨 4 开发环境")]),t._v(" "),s("ul",[s("li",[t._v("操作系统：Windows 10")]),t._v(" "),s("li",[t._v("后端IDE：IDEA")]),t._v(" "),s("li",[t._v("前端IDE：VS code")]),t._v(" "),s("li",[t._v("构建工具：Apache Maven")]),t._v(" "),s("li",[t._v("接口测试工具：Postman")]),t._v(" "),s("li",[t._v("压力测试工具：Apache JMeter")]),t._v(" "),s("li",[t._v("版本控制工具：Git")]),t._v(" "),s("li",[t._v("Java 版本：8")])]),t._v(" "),s("h2",{attrs:{id:"📑-5-目录结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📑-5-目录结构"}},[t._v("#")]),t._v(" 📑 5 目录结构")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("lecture-system\n├── db （数据库脚本）\n├── doc （文档相关）\n│\n├── lecture-common （公共部分）\n│   ├── config （配置类）\n│   ├── constant （常量）\n│   ├── entity （实体类）\n│   ├── exception （自定义异常）\n│   ├── filter （过滤器）\n│   ├── handler （自定义处理器）\n│   ├── service （service接口）\n│   ├── utils （工具类）\n│   └── vo\n│\n├── lecture-lecture （讲座微服务，核心）\n├── lecture-order （讲座预约微服务）\n├── lecture-user （用户登录微服务）\n├── nginx-lecture （win10测试nginx文件）\n├── vue-admin-template （前端工程）\n│ \n└── README.md\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br")])]),s("h2",{attrs:{id:"🌌-6-部署架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🌌-6-部署架构"}},[t._v("#")]),t._v(" 🌌 6 部署架构")]),t._v(" "),s("p",[t._v("Nginx：通过反向代理访问不同的服务器")]),t._v(" "),s("p",[t._v("前端服务：vue框架搭建的前端项目")]),t._v(" "),s("p",[t._v("微服务：处理各类业务、通过操作redis缓存数据、MySQL 存储数据")]),t._v(" "),s("p",[t._v("RabbitMQ：通过消息队列异步解决并发问题")]),t._v(" "),s("p",[t._v("Zookeeper：实现微服务的注册")]),t._v(" "),s("p",[t._v("阿里云OSS：存储用户上传的图片")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/deployment_architecture.png"}}),t._v(" "),s("p",[t._v("网站三层架构模型")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://studynote-images.oss-cn-hangzhou.aliyuncs.com/3architecture.png",alt:"6.2 网站三层架构模型"}}),t._v(" "),s("p",[t._v("由于资金问题，实际运行部署情况")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/deployment_real_architecture.png"}}),t._v(" "),s("p",[t._v("本地测试的部署情况")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/deployment_local_architecture.png"}}),t._v(" "),s("h2",{attrs:{id:"🎬-7-部署项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🎬-7-部署项目"}},[t._v("#")]),t._v(" 🎬 7 部署项目")]),t._v(" "),s("ul",[s("li",[t._v("配置 mysql\n"),s("ul",[s("li",[t._v("修改每一个项目中 application.yml 中 mysql的url, username 以及 password。")]),t._v(" "),s("li",[t._v("运行 db/data.sql 添加数据到数据库")])])]),t._v(" "),s("li",[t._v("配置 redis\n"),s("ul",[s("li",[t._v("修改每一个项目中 application.yml 中 redis 的 host, port 以及 password。")])])]),t._v(" "),s("li",[t._v("启动 Nginx\n"),s("ul",[s("li",[t._v("方式1：Window10 环境下，并保证所有项目都在该环境下运行时，启动 nginx-lecture 目录下的 niginx.exe")]),t._v(" "),s("li",[t._v("方式2：自定义 Nginx，并仿照 nginx-lecture/conf/nginx.conf 对自己的 Nginx 进行配置。")])])]),t._v(" "),s("li",[t._v("配置 Zookeeper\n"),s("ul",[s("li",[t._v("修改每一个项目中 application.yml 中 zookeeper 的 ip 地址。")])])]),t._v(" "),s("li",[t._v("配置 RabbitMQ\n"),s("ul",[s("li",[t._v("修改每一个项目中 application.yml 中 rabbitmq 的 host, username 以及 password。")])])]),t._v(" "),s("li",[t._v("配置 OSS\n"),s("ul",[s("li",[t._v("修改 lecture-oss 服务中的 application.yml 的阿里云OSS配置")])])]),t._v(" "),s("li",[t._v("配置前端\n"),s("ul",[s("li",[t._v("修改 "),s("code",[t._v(".env.*")]),t._v("中的前端请求路径 "),s("code",[t._v("VUE_APP_BASE_API")]),t._v(", 即 Nginx 监听端口。")])])])]),t._v(" "),s("h2",{attrs:{id:"📢-7-功能说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📢-7-功能说明"}},[t._v("#")]),t._v(" 📢 7 功能说明")]),t._v(" "),s("p",[t._v("在该系统中分为三个身份：「管理员Admin」、「管理员Manager」和「用户Student」，不同身份有不同的权限，不同的需求和任务。")]),t._v(" "),s("ul",[s("li",[t._v("「管理员Admin」拥有发布讲座、修改和签到统计所有讲座的权限；拥有用户管理的权限。")]),t._v(" "),s("li",[t._v("「管理员Manager」拥有发布讲座、修改和签到统计他所发布讲座的权限。")]),t._v(" "),s("li",[t._v("「用户Student」拥有讲座预约、取消预约的权限。")])]),t._v(" "),s("h3",{attrs:{id:"_7-1-讲座状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-讲座状态"}},[t._v("#")]),t._v(" 7.1 讲座状态")]),t._v(" "),s("p",[t._v("对于讲座来说，具有两种状态：「0发布」与「1结束」，这两种状态由管理员进行切换。")]),t._v(" "),s("p",[t._v("对于用户来说，每一个讲座都有如下的状态：未开放、未预约（已开放）、已预约、已签到、缺席、已结束。\n通过分析讲座预约开始的时间、讲座的状态、预约记录以及预约记录上的签到时间得出这些状态。\n"),s("img",{attrs:{src:"https://studynote-images.oss-cn-hangzhou.aliyuncs.com/lecture_state.png",alt:"lecture_state"}})]),t._v(" "),s("h3",{attrs:{id:"_7-2-用户操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-用户操作"}},[t._v("#")]),t._v(" 7.2 用户操作")]),t._v(" "),s("p",[t._v("用户关于讲座的操作包含：")]),t._v(" "),s("ul",[s("li",[t._v("评论：在讲座评论区进行留言评论")]),t._v(" "),s("li",[t._v("点赞：对喜欢的评论进行点赞")]),t._v(" "),s("li",[t._v("预约讲座：在讲座开始预约后，可以预约讲座")]),t._v(" "),s("li",[t._v("取消预约讲座：讲座关闭之前，可以取消预约讲座")]),t._v(" "),s("li",[t._v("签到：现场由管理员根据用户提供的用户名完成签到")])]),t._v(" "),s("p",[t._v("取消预约和预约之间可以反复操作，一旦完成签到就不能再取消预约了。")]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://studynote-images.oss-cn-hangzhou.aliyuncs.com/user_operation.png",alt:"user_operation"}}),t._v(" "),s("h2",{attrs:{id:"🎀-8-界面展示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🎀-8-界面展示"}},[t._v("#")]),t._v(" 🎀 8 界面展示")]),t._v(" "),s("h3",{attrs:{id:"_8-1-公共界面"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-公共界面"}},[t._v("#")]),t._v(" 8.1 公共界面")]),t._v(" "),s("p",[t._v("🔶 "),s("strong",[t._v("登录界面")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/UI_login.png",alt:"UI1"}})]),t._v(" "),s("p",[t._v("🔶 "),s("strong",[t._v("首页")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/UI_index.png",alt:"UI1"}})]),t._v(" "),s("p",[t._v("🔶 "),s("strong",[t._v("个人中心")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/UI_userCenter.png",alt:""}})]),t._v(" "),s("p",[t._v("🔶 "),s("strong",[t._v("评论模块")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/UI_comment.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_8-2-student界面展示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-student界面展示"}},[t._v("#")]),t._v(" 8.2 Student界面展示")]),t._v(" "),s("p",[t._v("🔶 "),s("strong",[t._v("讲座列表")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/UI_student_list.png",alt:""}})]),t._v(" "),s("p",[t._v("🔶 "),s("strong",[t._v("讲座详情")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/UI_student_info.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_8-3-admin界面展示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-admin界面展示"}},[t._v("#")]),t._v(" 8.3 Admin界面展示")]),t._v(" "),s("p",[t._v("🔶 "),s("strong",[t._v("讲座列表")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/UI_admin_list.png",alt:""}})]),t._v(" "),s("p",[t._v("🔶 "),s("strong",[t._v("添加讲座")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/UI_admin_add.png",alt:""}})]),t._v(" "),s("p",[t._v("🔶 "),s("strong",[t._v("讲座详情")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/UI_admin_info.png",alt:""}})]),t._v(" "),s("p",[t._v("🔶 "),s("strong",[t._v("讲座签到")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/UI_admin_sign.png",alt:""}})]),t._v(" "),s("p",[t._v("🔶 "),s("strong",[t._v("用户列表")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/UI_admin_userList.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"📌-9-功能逻辑图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#📌-9-功能逻辑图"}},[t._v("#")]),t._v(" 📌 9 功能逻辑图")]),t._v(" "),s("h3",{attrs:{id:"_9-1-用户登录模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-用户登录模块"}},[t._v("#")]),t._v(" 9.1 用户登录模块")]),t._v(" "),s("p",[t._v("用户模块使用Spring Security框架实现认证、授权两大功能。")]),t._v(" "),s("blockquote",[s("p",[t._v("认证（Authentication）：验证当前访问系统的是不是本系统的用户，并且确认具体是哪个用户。")]),t._v(" "),s("p",[t._v("授权（Authoritarian）：经过认证后判断当前用户是否有权限进行某个操作。")])]),t._v(" "),s("h4",{attrs:{id:"_9-1-1-认证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-1-认证"}},[t._v("#")]),t._v(" 9.1.1 认证")]),t._v(" "),s("p",[t._v("认证模块是验证当前访问系统的是不是本系统的用户，并且确认具体是哪个用户。\n如果用户未登录就需要让用户先登录再认证。")]),t._v(" "),s("p",[t._v("下图是登录认证模块，使用 Spring Security 提供的认证逻辑。")]),t._v(" "),s("p",[t._v("⭐ "),s("strong",[t._v("登录")]),t._v("：SpringSecurity过滤链放行 "),s("code",[t._v("/login")]),t._v(" 请求，成功调用 Controller 执行登录业务，通过Spring Security 模块来对用户的账号密码进行判断，若符合要求则登陆成功，最终将用户信息存储到 Redis 中，返回前端一个 token，之后每次的访问可以在请求头中携带这个 token，jwt 过滤器可以从 token 中解析出用户 id，通过用户 id 可以从 Redis 中获取用户登录信息判断用户是否登录。")]),t._v(" "),s("p",[t._v("⭐ "),s("strong",[t._v("正常请求")]),t._v("：任何一次请求都将经过 Security 过滤链，在 jwt 过滤器中将会对请求头中的 token 进行解析：")]),t._v(" "),s("ul",[s("li",[t._v("token 解析错误就是 token 非法或者 token 过期，将抛出异常，通过自定义的异常捕获器捕获异常，并将异常信息返回到前端。")]),t._v(" "),s("li",[t._v("token 正常解析出用户 id，通过 id 从 Redis 中获取用户信息，若获取不到说明用户未登录；若获取到了说明用户为登录状态，将当前的用户信息存储到 Spring Securiy 的容器当中。")])]),t._v(" "),s("p",[t._v("经过过滤器后，开始正常执行业务逻辑。")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/structure_login.png",alt:"structure_login.png"}}),t._v(" "),s("h4",{attrs:{id:"_9-1-2-授权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-2-授权"}},[t._v("#")]),t._v(" 9.1.2 授权")]),t._v(" "),s("h4",{attrs:{id:"_9-1-3-spring-security原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-3-spring-security原理"}},[t._v("#")]),t._v(" 9.1.3 Spring Security原理")]),t._v(" "),s("p",[t._v("下面对 Spring Security 的原理进行简单的介绍：")]),t._v(" "),s("p",[t._v("⭐ "),s("strong",[t._v("登录")])]),t._v(" "),s("ul",[s("li",[t._v("请求携带用户信息请求 "),s("code",[t._v("/login")]),t._v(" 接口，在配置类中配置 Spring Security 对  "),s("code",[t._v("/login")]),t._v("  接口进行匿名访问， 所以 Spring Security 会对 "),s("code",[t._v("/login")]),t._v(" 接口放行，之后执行登录业务。")]),t._v(" "),s("li",[t._v("登录业务中，使用 Spring Security 提供的 AuthenticationManager 进行认证。")]),t._v(" "),s("li",[t._v("通过实现 UserDetailService 接口，重写 loadUserByUsername 方法，该方法可以从数据库中获取用户信息返回 UserDetails 对象（LoginUser）。")]),t._v(" "),s("li",[t._v("通过继承 "),s("code",[t._v("DaoAuthenticationProvider")]),t._v(" 重写 "),s("code",[t._v("additionalAuthenticationChecks")]),t._v(" 方法完成自定义密码校验，首先将前端传入的密码进行AES解码获得密码明文，再将密码明文与数据库中的加密密码进行匹配。")]),t._v(" "),s("li",[t._v("认证成功后，将用户信息（LoginUser对象）存储在 redis 中，将 userId 封装成 jwt 返回到前端，也就是前端每次访问需要携带的 token。")])]),t._v(" "),s("p",[t._v("⭐ "),s("strong",[t._v("认证")])]),t._v(" "),s("ul",[s("li",[t._v("所有的请求将经过 Spring Security 过滤链，过滤链中包含自定义的 jwt 认证过滤器，可从请求头中获取的 token；使用 jwt 工具将 token 解析为 userId 后，从 redis 中获取用户信息。")]),t._v(" "),s("li",[t._v("如果从 redis 中成功获取 LoginUser 用户信息，就将该信息存储到 SecurityContextHolder 容器中，表示当前用户认证通过。")]),t._v(" "),s("li",[t._v("如果用户不存在，则返回认证失败的异常。")])]),t._v(" "),s("p",[t._v("⭐ "),s("strong",[t._v("异常处理")])]),t._v(" "),s("ul",[s("li",[t._v("认证失败异常，状态码（401）。实现 AuthenticationEntryPoint 接口，捕获并处理认证失败的异常。")]),t._v(" "),s("li",[t._v("权限不足，状态码（403）。实现 AccessDeniedHandler 接口，捕获并处理权限不足的异常。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/structure_SpringSecurity.png",alt:"structure_login.png"}})]),t._v(" "),s("h3",{attrs:{id:"_9-2-讲座管理模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-讲座管理模块"}},[t._v("#")]),t._v(" 9.2 讲座管理模块")]),t._v(" "),s("h4",{attrs:{id:"_9-2-1-讲座列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-1-讲座列表"}},[t._v("#")]),t._v(" 9.2.1 讲座列表")]),t._v(" "),s("p",[t._v("支持分页、条件查询所有数据库中的所有讲座。")]),t._v(" "),s("h4",{attrs:{id:"_9-2-2-讲座详情"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-2-讲座详情"}},[t._v("#")]),t._v(" 9.2.2 讲座详情")]),t._v(" "),s("p",[t._v("根据讲座id获取讲座详情，根据讲座id获取预约该讲座的所有用户预约记录。")]),t._v(" "),s("h4",{attrs:{id:"_9-2-3-添加更新讲座"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-3-添加更新讲座"}},[t._v("#")]),t._v(" 9.2.3 添加更新讲座")]),t._v(" "),s("p",[t._v("发布讲座或修改讲座，海报的上传需要阿里云的Oss服务。")]),t._v(" "),s("h4",{attrs:{id:"_9-2-4-讲座签到"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-4-讲座签到"}},[t._v("#")]),t._v(" 9.2.4 讲座签到")]),t._v(" "),s("p",[t._v("根据讲座id查询讲座详情，根据讲座id查询所有已签到用户列表。")]),t._v(" "),s("p",[t._v("通过输入用户名并点击签到按钮完成用户的签到，单个用户完成签到后立即刷新签到用户列表。")]),t._v(" "),s("p",[t._v("关闭签到系统后，讲座的状态从「0发布」变为「1结束」，用户预约讲座列表中将无法查询到该讲座，该讲座将无法被预约。")]),t._v(" "),s("h3",{attrs:{id:"_9-3-预约讲座模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-预约讲座模块"}},[t._v("#")]),t._v(" 9.3 预约讲座模块")]),t._v(" "),s("h4",{attrs:{id:"_9-3-1-讲座列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-1-讲座列表"}},[t._v("#")]),t._v(" 9.3.1 讲座列表")]),t._v(" "),s("p",[t._v("支持分页、条件查询所有状态为「0发布」的讲座。")]),t._v(" "),s("h4",{attrs:{id:"_9-3-2-我的讲座"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-2-我的讲座"}},[t._v("#")]),t._v(" 9.3.2 我的讲座")]),t._v(" "),s("p",[t._v("根据已登录用户的id查询所有已预约过的讲座。")]),t._v(" "),s("h4",{attrs:{id:"_9-3-3-预约与取消"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-3-预约与取消"}},[t._v("#")]),t._v(" 9.3.3 预约与取消")]),t._v(" "),s("p",[t._v("讲座预约模块主要实现两个功能： 用户预约讲座、用户取消讲座。")]),t._v(" "),s("p",[t._v("该过程需要 lecture-lecture 和 lecture-order 两个微服务共同完成。其中：")]),t._v(" "),s("p",[t._v("预约讲座")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("lecture-order 微服务：从 redis 中查询用户是否重复预定讲座、讲座是否还有剩余的可预约数量，\n如果用户未预约该讲座，且该讲座剩余可预约数量大于 0，则把讲座 id 和用户 id 封装为一个对象发送到消息队列，最后返回前端预约成功。")])]),t._v(" "),s("li",[s("p",[t._v("lecture-lecture 微服务：从消息队列中获取消息，操作数据库减少讲座可预约数量，添加用户预约记录；\n操作redis减少讲座可预约数量，添加用户预约记录。")])])]),t._v(" "),s("p",[t._v("取消预约讲座")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("lecture-order 微服务：从 redis 中查询用户是否预约讲座，若用户未预约该讲座则抛出异常；若用户预约该讲座，则远程调用 lecture-lecture 微服务。")])]),t._v(" "),s("li",[s("p",[t._v("lecture-lecture 微服务：查询讲座是否结束，若结束则抛出异常；查询用户是否签到，若签到则抛出异常；删除用户预约记录，\n增加给定id讲座的剩余可预约数量，最后删除 redis 内用户的预约记录。")])])]),t._v(" "),s("p",[t._v("流程图如下：")]),t._v(" "),s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/structure_order.png",alt:"structure_login.png"}}),t._v(" "),s("h3",{attrs:{id:"_9-4-用户列表模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-用户列表模块"}},[t._v("#")]),t._v(" 9.4 用户列表模块")]),t._v(" "),s("h4",{attrs:{id:"_9-4-1-分页查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-1-分页查询"}},[t._v("#")]),t._v(" 9.4.1 分页查询")]),t._v(" "),s("p",[t._v("「管理员Admin」可以分页、条件查询数据库中所有用户信息，不包含被逻辑删除的用户；同时可以辑删除用户（数据库is_deleted = 1表示被删除）")]),t._v(" "),s("h4",{attrs:{id:"_9-4-2-添加新用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-2-添加新用户"}},[t._v("#")]),t._v(" 9.4.2 添加新用户")]),t._v(" "),s("p",[t._v("填写必要的用户字段添加用户。密码传输经过加密处理。")]),t._v(" "),s("p",[t._v("由于 http 是明文传输，为了保证密码的安全，前端在传输密码的时候需要对密码进行加密，在后端对密码进行解密，存储到数据库的时候再对密码进行加密。")]),t._v(" "),s("h3",{attrs:{id:"_9-5-个人中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-5-个人中心"}},[t._v("#")]),t._v(" 9.5 个人中心")]),t._v(" "),s("h4",{attrs:{id:"_9-5-1-修改密码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-5-1-修改密码"}},[t._v("#")]),t._v(" 9.5.1 修改密码")]),t._v(" "),s("p",[t._v("输入原密码，填写新密码。密码传输经过加密处理。")]),t._v(" "),s("h4",{attrs:{id:"_9-5-2-修改信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-5-2-修改信息"}},[t._v("#")]),t._v(" 9.5.2 修改信息")]),t._v(" "),s("p",[t._v("填写需要修改的字段。")]),t._v(" "),s("h4",{attrs:{id:"_9-5-3-密码加密与传输"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-5-3-密码加密与传输"}},[t._v("#")]),t._v(" 9.5.3 密码加密与传输")]),t._v(" "),s("p",[t._v("由于 http 是明文传输，为了保证密码的安全，前端在传输密码的时候需要对密码进行加密，在后端对密码进行解密，存储到数据库的时候再对密码进行加密。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/password_crpty.png",alt:""}})]),t._v(" "),s("p",[t._v("数据库中的密码采用加密的方式存储，即使数据库被盗，黑客也不能用密文作为密码进行登录，确保了账号的安全。")]),t._v(" "),s("h3",{attrs:{id:"_9-6-评论模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-6-评论模块"}},[t._v("#")]),t._v(" 9.6 评论模块")]),t._v(" "),s("p",[t._v("在数据库中，评论分为两类：父级评论和子级评论，子评论包含指向父评论和根评论的指针。")]),t._v(" "),s("blockquote",[s("p",[t._v("父评论：评论A、评论B、评论C")]),t._v(" "),s("p",[t._v("子评论：评论B1、评论B2、评论B3、评论1、评论2")]),t._v(" "),s("p",[t._v("评论2的根评论为评论B，父评论为评论1。")])]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/comment_relation_db.png"}}),t._v(" "),s("h4",{attrs:{id:"_9-6-1-获取评论"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-6-1-获取评论"}},[t._v("#")]),t._v(" 9.6.1 获取评论")]),t._v(" "),s("p",[t._v("根据讲座id获取所有评论，根据评论之间的关系封装好评论数据发给前端。此时，将子评论同级之间进行封装，有利于前端显示。")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/comment_relation_json.png"}}),t._v(" "),s("h4",{attrs:{id:"_9-6-2-添加评论"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-6-2-添加评论"}},[t._v("#")]),t._v(" 9.6.2 添加评论")]),t._v(" "),s("p",[t._v("根据讲座 id、用户 id、父评论 id、根评论 id 和评论内容添加讲座信息。异步产生消息通知给被评论者，加快响应速度（见9.7消息通知）。")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/structure_add_comment.png"}}),t._v(" "),s("h4",{attrs:{id:"_9-6-3-删除评论"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-6-3-删除评论"}},[t._v("#")]),t._v(" 9.6.3. 删除评论")]),t._v(" "),s("p",[t._v("根据评论 id、用户 id 删除评论及其子评论。")]),t._v(" "),s("h4",{attrs:{id:"_9-6-4-点赞功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-6-4-点赞功能"}},[t._v("#")]),t._v(" 9.6.4 点赞功能")]),t._v(" "),s("p",[t._v("用户可以在讲座详情页面对每一个评论进行点赞或取消点赞，点赞的数据以 set 数据结构存储在 redis 缓存内，键为 "),s("code",[t._v("commentLikes:讲座id")]),t._v("，值为 "),s("code",[t._v("用户id")]),t._v("，使用 set 数据结构可以保证每一个用户只能点赞一次，并且可以快速判断该用户是否点赞以及某一条评论的点赞总数。同时，异步产生消息通知给被点赞者，加快响应速度（见9.7消息通知）。")]),t._v(" "),s("img",{staticStyle:{zoom:"60%"},attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/structure_likes.png"}}),t._v(" "),s("h3",{attrs:{id:"_9-7-消息通知模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-7-消息通知模块"}},[t._v("#")]),t._v(" 9.7 消息通知模块")]),t._v(" "),s("h4",{attrs:{id:"_9-7-1-用户获取消息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-7-1-用户获取消息"}},[t._v("#")]),t._v(" 9.7.1 用户获取消息")]),t._v(" "),s("p",[t._v("系统消息数据存储在 redis 内，采用 list 数据结构，针对每一个用户创建一个 list 存储消息，键为 "),s("code",[t._v("systemMessage:用户id")]),t._v("，值为包含消息内容、讲座 id、目标用户id属性的对象。用户在登录网站时每间隔 1 分钟获取系统消息数量，显示在导航栏右上角的头像位置。可在用户中心内查看系统消息，当查看完后，所有消息将pop 出 list 队列。")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/structure_get_message.png"}}),t._v(" "),s("h4",{attrs:{id:"_9-7-2-生产消息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-7-2-生产消息"}},[t._v("#")]),t._v(" 9.7.2 生产消息")]),t._v(" "),s("p",[t._v("当有用户点赞或评论时将产生系统消息，为了加快点赞和评论的响应速度，生成系统消息的过程采用异步处理，通过消息队列来实现异步操作。")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://lecture-system.oss-cn-shanghai.aliyuncs.com/images/structure_add_message.png"}}),t._v(" "),s("h2",{attrs:{id:"⌚-10-待实现及优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#⌚-10-待实现及优化"}},[t._v("#")]),t._v(" ⌚ 10 待实现及优化")]),t._v(" "),s("ul",[s("li",[t._v("[ ] 点赞数据存储到数据库")]),t._v(" "),s("li",[t._v("[ ] 逐条消费系统消息（目前只能一次性查看所有系统消息）")]),t._v(" "),s("li",[t._v("[ ] 讲座即将开始系统消息提示")]),t._v(" "),s("li",[t._v("[ ] 管理员可以发布通知给预约某一场讲座的所有用户")])]),t._v(" "),s("h2",{attrs:{id:"🙇‍♂️-11-学习参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#🙇‍♂️-11-学习参考"}},[t._v("#")]),t._v(" 🙇‍♂️ 11 学习参考")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.bilibili.com/video/BV1dQ4y1A75e?p=1",target:"_blank",rel:"noopener noreferrer"}},[t._v("1 尚硅谷全栈项目——谷粒学院"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("描述：在线学习网站，管理员可以通过后台管理系统上传教师信息、课程大纲、课程视频等；学生可以在前台页面中查看教师、课程等内容。")]),t._v(" "),s("p",[t._v("参考学习内容：前端知识的学习、前端 vue 模板的使用，element-ui 的使用，前后端开发的流程。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://gitee.com/renrenio",target:"_blank",rel:"noopener noreferrer"}},[t._v("2 renren-fast"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("描述：前后端快速开发的框架")]),t._v(" "),s("p",[t._v("参考学习内容：代码生成器、权限管理的数据库设计、响应类的设计")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.bilibili.com/video/BV1sf4y1L7KE?p=2",target:"_blank",rel:"noopener noreferrer"}},[t._v("3 秒杀项目"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("描述：简单的后端秒杀系统")]),t._v(" "),s("p",[t._v("参考学习内容：秒杀的架构设计和基本流程、压力测试；redis、rabbitMQ 的使用")])])}),[],!1,null,null,null);s.default=e.exports}}]);