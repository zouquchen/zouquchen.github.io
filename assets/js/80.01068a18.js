(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{403:function(s,t,a){"use strict";a.r(t);var n=a(8),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ioå¤šè·¯å¤ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ioå¤šè·¯å¤ç”¨"}},[s._v("#")]),s._v(" IOå¤šè·¯å¤ç”¨")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("ä¸ºä»€ä¹ˆè¦äº†è§£ IO å¤šè·¯å¤ç”¨æŠ€æœ¯")]),s._v(" "),t("ol",[t("li",[s._v("é¢è¯•ä¸­ä¼šè€ƒï¼›")]),s._v(" "),t("li",[s._v("åœ¨ redisã€nginx ä»¥åŠ Java NIO ä¸­éƒ½æœ‰ä½¿ç”¨ï¼Œå¿…è¦äº†è§£ä¸€ä¸‹ã€‚")])])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("å‚è€ƒè§†é¢‘")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.bilibili.com/video/BV19D4y1o797",target:"_blank",rel:"noopener noreferrer"}},[s._v("IOå¤šè·¯å¤ç”¨åº•å±‚åŸç†å…¨è§£"),t("OutboundLink")],1),s._v("ï¼šè®²çš„å¾ˆç»†è‡´ï¼Œæ—¶é—´æ¯”è¾ƒé•¿")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.bilibili.com/video/BV1qJ411w7du",target:"_blank",rel:"noopener noreferrer"}},[s._v("IOå¤šè·¯å¤ç”¨select/poll/epollä»‹ç»"),t("OutboundLink")],1),s._v("ï¼šselect å’Œ poll è®²çš„å¾ˆå¥½ï¼Œepoll éƒ¨åˆ†å°±åœ¨çè®²äº†")])]),s._v(" "),t("h2",{attrs:{id:"é—®é¢˜å¼•å‡º"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é—®é¢˜å¼•å‡º"}},[s._v("#")]),s._v(" é—®é¢˜å¼•å‡º")]),s._v(" "),t("p",[s._v("ğŸ”Š "),t("strong",[s._v("é—®é¢˜")]),s._v("ï¼š")]),s._v(" "),t("p",[s._v("å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨ï¼Œå¯ä»¥ä¾›å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥ï¼Œå¹¶ä¸”èƒ½å¤„ç†è¿™äº›å®¢æˆ·ç«¯ä¼ ä¸Šæ¥çš„è¯·æ±‚ï¼Ÿ")]),s._v(" "),t("p",[s._v("ğŸ™‹â€â™‚ï¸ "),t("strong",[s._v("æ–¹æ¡ˆ1")]),s._v("ï¼š")]),s._v(" "),t("p",[s._v("ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚ä½†éœ€è¦ CPU çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå½“è¯·æ±‚ç‰¹åˆ«å¤šçš„æ—¶å€™æ•ˆç‡ä½ã€‚")]),s._v(" "),t("p",[s._v("ğŸ™‹â€â™‚ï¸ "),t("strong",[s._v("æ–¹æ¡ˆ2")]),s._v("ï¼š")]),s._v(" "),t("p",[s._v("ä½¿ç”¨å•çº¿ç¨‹ï¼Œåœ¨è¯´æ˜è§£å†³æ–¹æ³•ä¹‹å‰æˆ‘ä»¬è¦çŸ¥é“ï¼š")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("ä½¿ç”¨å•çº¿ç¨‹æ—¶ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨å¤„ç† A çš„è¯·æ±‚æ—¶ï¼ŒB å‘é€ä¸Šæ¥çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œå› ä¸ºåœ¨ç½‘å¡é‡Œæœ‰ DMAï¼Œå®ƒå¯ä»¥åœ¨ä¸éœ€è¦ CPU çš„æƒ…å†µä¸‹å°†æ•°æ®å†™å…¥åˆ°å†…å­˜å½“ä¸­ã€‚")])]),s._v(" "),t("li",[t("p",[s._v("åœ¨ Linux ç³»ç»Ÿä¸­æ¯ä¸€ä¸ªç½‘ç»œè¿æ¥éƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨å†…æ ¸ä¸­ä»¥æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰çš„å½¢å¼å­˜åœ¨ã€‚")])])]),s._v(" "),t("p",[s._v("æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸‹é¢çš„æ–¹æ¡ˆï¼ŒæŠŠæ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­è¿›è¡Œéå†ï¼Œå¦‚æœéå†åˆ°æŸä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»å–æ•°æ®ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œè¯»å–æ•°æ®çš„æ“ä½œã€‚")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("while(1) {\n\tfor (Fdx in [FdA, FdB, ..., Fdn, ...]) {\n\t\tif (Fdx æœ‰æ•°æ®) {\n\t\t\tè¯»å–Fdxæ•°æ®;\n\t\t\tå¤„ç†æ•°æ®;\n\t\t}\n\t}\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("è™½ç„¶å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯å®ƒçš„æ€§èƒ½ä¾ç„¶ä¸å¤Ÿå¥½ï¼Œå› ä¸ºå®ƒæ˜¯ç”¨æˆ‘ä»¬çš„ç¨‹åºåˆ¤æ–­çš„ï¼Œå¹¶ä¸æ˜¯ä»æ“ä½œç³»ç»Ÿåº•å±‚è§£å†³çš„é—®é¢˜ã€‚")]),s._v(" "),t("h2",{attrs:{id:"select"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#select"}},[s._v("#")]),s._v(" select")]),s._v(" "),t("h3",{attrs:{id:"select-çš„ä½œç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#select-çš„ä½œç”¨"}},[s._v("#")]),s._v(" select çš„ä½œç”¨")]),s._v(" "),t("p",[s._v("åœ¨ Linux ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ select å‡½æ•°å®ç° I/O ç«¯å£çš„å¤ç”¨ï¼Œä¼ é€’ç»™ select å‡½æ•°çš„å‚æ•°ä¼šå‘Šè¯‰å†…æ ¸ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("æˆ‘ä»¬æ‰€å…³å¿ƒçš„æ–‡ä»¶æè¿°ç¬¦")]),s._v(" "),t("li",[s._v("å¯¹æ¯ä¸ªæè¿°ç¬¦ï¼Œæˆ‘ä»¬æ‰€å…³å¿ƒçš„çŠ¶æ€ã€‚")]),s._v(" "),t("li",[s._v("æˆ‘ä»¬è¦ç­‰å¾…å¤šé•¿æ—¶é—´ã€‚")])]),s._v(" "),t("p",[s._v("ä»selectå‡½æ•°è¿”å›åï¼Œå†…æ ¸å‘Šè¯‰æˆ‘ä»¬ä»¥ä¸‹ä¿¡æ¯:")]),s._v(" "),t("ol",[t("li",[s._v("å¯¹æˆ‘ä»¬çš„è¦æ±‚å·²ç»åšå¥½å‡†å¤‡çš„æè¿°ç¬¦çš„ä¸ªæ•°")]),s._v(" "),t("li",[s._v("å¯¹äºä¸‰ç§æ¡ä»¶å“ªäº›æè¿°ç¬¦å·²ç»åšå¥½å‡†å¤‡ï¼ˆè¯»ï¼Œå†™ï¼Œå¼‚å¸¸ï¼‰")])]),s._v(" "),t("p",[s._v("æœ‰äº†è¿™äº›è¿”å›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨åˆé€‚çš„ I/O å‡½æ•°ï¼ˆé€šå¸¸æ˜¯ read æˆ– writeï¼‰ï¼Œå¹¶ä¸”è¿™äº›å‡½æ•°ä¸ä¼šå†é˜»å¡ã€‚")]),s._v(" "),t("h3",{attrs:{id:"select-api-è¯´æ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#select-api-è¯´æ˜"}},[s._v("#")]),s._v(" select API è¯´æ˜")]),s._v(" "),t("p",[t("strong",[s._v("å‡½æ•°æ¥å£")]),s._v("ï¼š")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("<sys/select.h>")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("select")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" maxfdp1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fd_set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("readset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fd_set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("writeset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fd_set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("exceptset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("timeval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("â­ "),t("strong",[s._v("è¿”å›å€¼")])]),s._v(" "),t("p",[s._v("åšå¥½å‡†å¤‡çš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼Œè¶…æ—¶ä¸º 0ï¼Œé”™è¯¯ä¸º -1")]),s._v(" "),t("p",[s._v("â­ "),t("strong",[s._v("maxfdp1")])]),s._v(" "),t("p",[s._v("æ•´å‹æ•°ï¼ŒæŒ‡æ•°ç»„ä¸­æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦çš„èŒƒå›´ï¼Œæœ€å¤§çš„æ–‡ä»¶æè¿°ç¬¦çš„å€¼åŠ  1")]),s._v(" "),t("p",[s._v("â­  "),t("strong",[s._v("set")])]),s._v(" "),t("p",[s._v("ä¸­é—´ä¸‰ä¸ªå‚æ•°æŒ‡å‘æè¿°ç¬¦é›†ï¼ŒæŒ‡æ˜äº†æˆ‘ä»¬å…³å¿ƒå“ªäº›æè¿°ç¬¦ï¼Œå¹¶éœ€è¦æ»¡è¶³å“ªäº›æ¡ä»¶ï¼ˆå¯å†™ï¼Œå¯è¯»ï¼Œå¼‚å¸¸ï¼‰ï¼Œæˆ‘ä»¬åªéœ€ç†è§£ readsetï¼Œåªè€ƒè™‘å“ªäº›æ–‡ä»¶æè¿°ç¬¦å·²ç»åšå¥½è¢«è¯»çš„å‡†å¤‡äº†")]),s._v(" "),t("p",[s._v("â­ "),t("strong",[s._v("timeout")])]),s._v(" "),t("p",[s._v("å®ƒæŒ‡æ˜æˆ‘ä»¬è¦ç­‰å¾…çš„æ—¶é—´:")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("timeval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" tv_ sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*ç§’ */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" tv_ usec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*å¾®ç§’*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("æœ‰ä¸‰ç§æƒ…å†µ:")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("timeout == NULL")]),s._v(" ç­‰å¾…æ— é™é•¿çš„æ—¶é—´ã€‚")]),s._v(" "),t("li",[t("code",[s._v("timeout->tv_ sec == 0 && timeout->tv _usec == 0")]),s._v(" ä¸ç­‰å¾…ï¼Œç›´æ¥è¿”å›ã€‚(éé˜»å¡)")]),s._v(" "),t("li",[t("code",[s._v("timeout->tv sec !=0 || timeout->tv_ usec!= 0")]),s._v(" ç­‰å¾…æŒ‡å®šçš„æ—¶é—´ã€‚")])]),s._v(" "),t("h3",{attrs:{id:"æ“ä½œ-fds-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ“ä½œ-fds-api"}},[s._v("#")]),s._v(" æ“ä½œ Fds API")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* å°†fd_setçš„æ‰€æœ‰ä½éƒ½è®¾ä¸º0 */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_ZERO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fd_set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("fdset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* æ¸…é™¤æŸä¸ªä½ */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_CLR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fd_set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("fdset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* å°†æŒ‡å®šä½ç½®çš„bitå€¼è®¾ç½®ä¸º1 */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_SET")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fd_set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("fdset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* æµ‹è¯•æŸä¸ªä½æ˜¯å¦è¢«ç½®ä½ */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_ISSET")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fd_set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("fdset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"ä¸¾ä¾‹è¯´æ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸¾ä¾‹è¯´æ˜"}},[s._v("#")]),s._v(" ä¸¾ä¾‹è¯´æ˜")]),s._v(" "),t("p",[s._v("æˆ‘ä»¬ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ºæ¡ˆä¾‹æ¥è¯¦ç»†äº†è§£ selectï¼Œæˆ‘ä»¬å°†é€æ­¥åˆ†ææ¯ä¸€éƒ¨åˆ†")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[s._v("sockfd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("socket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("AF_INET"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" SOCK_STREAM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\naddr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sin_family "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" AF_INET"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\naddr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sin_port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("htons")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\naddr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sin_addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("s_addr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" INADDR_ANY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sockaddr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("addr "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    addrlen "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sockaddr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("addrlen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" max"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        max "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_ZERO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_SET")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"round again"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("select")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_ISSET")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MAXBUF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MAXBUF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\t\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[s._v("â­ "),t("strong",[s._v("ç¬¬ä¸€éƒ¨åˆ†")]),s._v("ï¼šå‡†å¤‡æ–‡ä»¶æè¿°ç¬¦æ•°ç»„ fds")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[s._v("sockfd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("socket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("AF_INET"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" SOCK_STREAM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\naddr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sin_family "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" AF_INET"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\naddr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sin_port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("htons")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\naddr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sin_addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("s_addr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" INADDR_ANY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sockaddr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("addr "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    addrlen "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ–‡ä»¶æè¿°ç¬¦å­˜å‚¨åˆ° fds ä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶æè¿°å°±æ˜¯ä¸€ä¸ªéšæœºçš„æ•°å­—ï¼ˆç¼–å·ï¼‰")]),s._v("\n    fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sockaddr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("addrlen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ±‚å‡ºæœ€å¤§çš„æ–‡ä»¶æè¿°ç¬¦ç¼–å·")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" max"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        max "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("è¿™éƒ¨åˆ†ä»£ç åªéœ€è¦æµ…æµ…çš„äº†è§£ä¸€ä¸‹å°±å¥½äº†ï¼Œæˆ‘ä»¬åªè¦çŸ¥é“è¿™å‡ ç‚¹å³å¯ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("fds æ˜¯ç”¨äºå­˜å‚¨æ–‡ä»¶æè¿°ç¬¦çš„æ•°ç»„")]),s._v(" "),t("li",[s._v("æ¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªéšæœºçš„æ•°å­—ï¼ˆç¼–å·ï¼‰")]),s._v(" "),t("li",[s._v("max è®°å½•äº†è¿™äº›æ–‡ä»¶æè¿°ç¬¦ä¸­ç¼–å·æœ€å¤§çš„å€¼")])]),s._v(" "),t("p",[s._v("å› ä¸ºä¸€å…±å»ºç«‹äº† 5 ä¸ª socket è¿æ¥ï¼Œæ‰€ä»¥æ•°ç»„çš„å¤§å°ä¸º 5ã€‚æˆ‘ä»¬å¯ä»¥å‡è®¾è¿™ 5 ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ç¼–å·ä¸º1ã€2ã€5ã€7ã€9")]),s._v(" "),t("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs2022/IO-Multiplexing-select1.png",alt:"IO-Multiplexing-select1"}}),s._v(" "),t("p",[s._v("â­ "),t("strong",[s._v("ç¬¬äºŒéƒ¨åˆ†")]),s._v("ï¼šè°ƒç”¨ select æ–¹æ³•")]),s._v(" "),t("blockquote",[t("p",[s._v("ä¸‹é¢ä»£ç ä¸­ä½¿ç”¨çš„ API åœ¨å‰é¢éƒ½å·²ç»ä»‹ç»äº†ï¼Œçœ‹ä¸æ‡‚çš„ API å¯ä»¥å†å»å‰é¢çœ‹çœ‹")])]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œçš„ rset é›†åˆä¼šåå¤ä½¿ç”¨ï¼Œæ¯æ¬¡ä½¿ç”¨ä¹‹å‰è¦å…¨éƒ¨ç½® 0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_ZERO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_SET")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("rset å°±æ˜¯å³å°†ä¼ å…¥ select æ–¹æ³•ä¸­çš„ readsetï¼Œå®ƒçš„æ•°æ®ç»“æ„æ˜¯ bitmapï¼Œé»˜è®¤å¤§å°ä¸º 1024ã€‚å› ä¸ºå®ƒä¼šåœ¨æ¯ä¸€æ¬¡å¾ªç¯ä¸­åå¤ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨æ¯ä¸€æ¬¡ä½¿ç”¨ä¹‹å‰éƒ½ä¼šè°ƒç”¨ "),t("code",[s._v("FD_ZERO()")]),s._v(" æ–¹æ³•å°† rset ä½å›¾ä¸­çš„æ‰€æœ‰ä½éƒ½æ¸…é›¶ï¼Œè¿™ä¸ª API åœ¨å‰é¢ä»‹ç»è¿‡ã€‚")]),s._v(" "),t("p",[s._v("é€šè¿‡ä¸€ä¸ª for å¾ªç¯ï¼Œæˆ‘ä»¬å°† fds æ•°ç»„è½¬æ¢æˆæˆ‘ä»¬éœ€è¦çš„ rset ä½å›¾ï¼Œä½å›¾çš„ç¬¬ 1ã€2ã€5ã€7ã€9 ä½ç½®1ï¼š")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs2022/IO-Multiplexing-select2.png",alt:"IO-Multiplexing-select2"}})]),s._v(" "),t("p",[s._v("ä¸‹é¢å¼€å§‹è°ƒç”¨ "),t("code",[s._v("select()")]),s._v(" æ–¹æ³•")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œçš„ rset é›†åˆä¼šåå¤ä½¿ç”¨ï¼Œæ¯æ¬¡ä½¿ç”¨ä¹‹å‰è¦å…¨éƒ¨ç½® 0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_ZERO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_SET")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"round again"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è°ƒç”¨ select æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬åªå…³å¿ƒè¯»ï¼Œè€Œä¸å…³æ³¨å†™å’Œå¼‚å¸¸ï¼Œæ‰€ä»¥åªæ˜¯ä¼ å…¥äº† readset çš„å€¼")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ¤æ–­å“ªäº›æ–‡ä»¶å·²ç»åšå¥½è¯»çš„å‡†å¤‡äº†")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º nullï¼Œç­‰å¾…æ— é™é•¿æ—¶é—´")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("select")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ²¡æœ‰æ•°æ®å‡†å¤‡å¥½ï¼Œå°†ä¸€ç›´é˜»å¡åœ¨è¿™é‡Œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("å‰é¢æˆ‘ä»¬ä»‹ç»äº† "),t("code",[s._v("select()")]),s._v(" æ–¹æ³•çš„ APIï¼Œè¿™é‡Œæˆ‘ä»¬åªå…³å¿ƒè¯»ï¼Œè€Œä¸å…³å¿ƒå†™å’Œå¼‚å¸¸ï¼Œæ‰€ä»¥åªä¼ å…¥äº† readset ä½å›¾ï¼Œç”¨äºåˆ¤æ–­å“ªäº›æ–‡ä»¶åšå¥½äº†è¯»çš„å‡†å¤‡ï¼›è¶…æ—¶æ—¶é—´ä¸º nullï¼Œç­‰å¾…æ— é™é•¿æ—¶é—´ã€‚")]),s._v(" "),t("p",[s._v("select çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼Œå…ˆæŠŠç”¨æˆ·æ€çš„ rset å¤åˆ¶åˆ°å†…æ ¸æ€ä¸­ï¼Œåœ¨å†…æ ¸æ€ä¸­åˆ¤æ–­æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦è¯»å–å¥½æ•°æ®ã€‚å†…æ ¸æ€çš„åˆ¤æ–­æ¯”ç”¨æˆ·æ€æ•ˆç‡é«˜ï¼Œå› ä¸ºç”¨æˆ·æ€çš„åˆ¤æ–­ä¹Ÿæ˜¯è¦é€šè¿‡å†…æ ¸æ€ã€‚å¦‚æœæ²¡æœ‰æ•°æ®å‡†å¤‡å¥½ï¼Œå†…æ ¸æ€å°†ä¸€ç›´åˆ¤æ–­ï¼Œselect å‡½æ•°å°†ä¸€ç›´é˜»å¡åœ¨é‚£é‡Œã€‚")]),s._v(" "),t("p",[s._v("ç”±äº rset çš„ä½æ•°ä¸º 1024ï¼Œæˆ‘ä»¬åªç”¨äº†å…¶ä¸­çš„ 0 åˆ° 9 ä½ï¼Œéå†å‰©ä¸‹çš„ 1000 å¤šä½éƒ½æ˜¯æµªè´¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ "),t("code",[s._v("max + 1")]),s._v(" æŒ‡æ˜æˆ‘ä»¬åªéœ€è¦éå†åˆ° "),t("code",[s._v("max + 1")]),s._v(" ä½å³å¯ï¼Œåé¢çš„æ•°æ®ä¸éœ€è¿›è¡Œéå†ã€‚")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs2022/IO-Multiplexing-select3.png",alt:"image-20220816110220161"}})]),s._v(" "),t("p",[s._v("å½“æœ‰æ•°æ®åˆ°æ¥æ—¶ï¼Œå†…æ ¸ä¼šå°†æœ‰æ•°æ®çš„ fd ç½®ä½ï¼Œè¡¨ç¤ºå·²ç»æœ‰æ•°æ®æ¥äº†ï¼ˆrset ä¸­å·²ç»ç½® 1 äº†ï¼Œè¿™ä¸ªåœ°æ–¹æ€ä¹ˆå®ç°çš„ç½®ä½ï¼Œæˆ‘ä¸å¤ªè¯·ï¼‰ï¼Œä¹‹å select å°†è¿”å›ï¼Œç¨‹åºå°†ç»§ç»­å‘ä¸‹è¿è¡Œã€‚")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œçš„ rset é›†åˆä¼šåå¤ä½¿ç”¨ï¼Œæ¯æ¬¡ä½¿ç”¨ä¹‹å‰è¦å…¨éƒ¨ç½® 0")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_ZERO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_SET")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"round again"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è°ƒç”¨ select æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬åªå…³å¿ƒè¯»ï¼Œè€Œä¸å…³æ³¨å†™å’Œå¼‚å¸¸ï¼Œæ‰€ä»¥åªæ˜¯ä¼ å…¥äº† readset çš„å€¼")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ¤æ–­å“ªäº›æ–‡ä»¶å·²ç»åšå¥½è¯»çš„å‡†å¤‡äº†")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º nullï¼Œç­‰å¾…æ— é™é•¿æ—¶é—´")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("select")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ²¡æœ‰æ•°æ®å‡†å¤‡å¥½ï¼Œå°†ä¸€ç›´é˜»å¡åœ¨è¿™é‡Œ")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// éå† fdsï¼Œæ ¹æ® rset åˆ¤æ–­å“ªäº›æ•°æ®å¯ä»¥è¯»å–äº†")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("FD_ISSET")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("rset"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸‹é¢å¤„ç†æ•°æ®")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MAXBUF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MAXBUF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\t\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("éå† fdsï¼Œæ ¹æ® rset åˆ¤æ–­å“ªäº›æ•°æ®å¯ä»¥è¯»å–äº†ï¼Œç„¶åå¯¹è¿™äº›æ•°æ®è¿›è¡Œè¯»å–å’Œå¤„ç†ã€‚")]),s._v(" "),t("h3",{attrs:{id:"select-æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#select-æ€»ç»“"}},[s._v("#")]),s._v(" select æ€»ç»“")]),s._v(" "),t("p",[s._v("æˆ‘ä»¬å°†å…¨éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ”¶é›†è¿‡æ¥äº¤ç»™å†…æ ¸å»å¤„ç†ï¼Œå†…æ ¸å¸®æˆ‘ä»¬éå†å“ªäº›æ•°æ®å·²ç»å‡†å¤‡å¥½äº†ï¼Œå½“å…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å‡†å¤‡å¥½åï¼Œselect å‡½æ•°ä¼šè¿”å›ï¼Œå¹¶ä¸”æœ‰æ•°æ®çš„ fd ä¼šç½®ä½ã€‚è¿”å›ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹éå†æ•°æ®ï¼Œæ ¹æ® rset æ¥åˆ¤æ–­å“ªäº›æ•°æ®å·²ç»å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”å¯¹å‡†å¤‡å¥½çš„æ•°æ®è¿›è¡Œè¯»å–å’Œå¤„ç†ã€‚")]),s._v(" "),t("p",[s._v("æé«˜æ•ˆç‡çš„åŸå› æ˜¯ï¼šå°† fd äº¤ç»™å†…æ ¸å»å¤„ç†ï¼Œå†…æ ¸å¤„ç†å¥½åå†å‘Šè¯‰ç”¨æˆ·æ¥è¯»å–å’Œå¤„ç†ã€‚")]),s._v(" "),t("p",[s._v("select çš„ç¼ºç‚¹ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("rset ä½å›¾çš„é»˜è®¤å¤§å°ä¸º 1024ï¼Œå¤„ç†çš„æ•°é‡æœ‰ä¸Šé™")]),s._v(" "),t("li",[s._v("rset ä¸å¯é‡ç”¨ï¼Œæ¯ä¸€æ¬¡ä½¿ç”¨éƒ½éœ€è¦æ¸…é›¶ï¼Œå†é€šè¿‡ fds æ•°ç»„è¿›è¡Œç½®ä½")]),s._v(" "),t("li",[s._v("rset ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€éœ€è¦å¼€é”€")]),s._v(" "),t("li",[s._v("select è¿”ä¼šåæˆ‘ä»¬çŸ¥é“å…¶ä¸­å·²ç»æœ‰ fd å¤„äºæœ‰æ•°æ®çš„çŠ¶æ€ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“å“ªä¸ªæˆ–å“ªå‡ ä¸ªæœ‰æ•°æ®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å»éå†æ‰€æœ‰ fdï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)")])]),s._v(" "),t("h2",{attrs:{id:"poll"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#poll"}},[s._v("#")]),s._v(" poll")]),s._v(" "),t("p",[s._v("ä¸‹é¢ç®€å•ä»‹ç»ä»¥ä¸‹ pollï¼Œäº†è§£äº† select çš„åŸç†ï¼Œç†è§£ poll å°±ä¼šå¾ˆè½»æ¾äº†ã€‚")]),s._v(" "),t("p",[s._v("poll ä¸å†ä½¿ç”¨ bitmap æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸€ä¸ª pollfd ç»“æ„ä½“ï¼Œpoll çš„æ‰€æœ‰æ”¹è¿›éƒ½æ˜¯åŸºäºæ•´ä¸ªç»“æ„ä½“å±•å¼€çš„ï¼Œæ‰€æœ‰çš„æ–‡ä»¶æè¿°ç¬¦æ”¾åœ¨ pollfds æ•°ç»„ä¸­ã€‚")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("pollfd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("short")]),s._v(" events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("short")]),s._v(" revents"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("ä¸‰ä¸ªå˜é‡çš„å«ä¹‰ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("fdï¼šæ–‡ä»¶æè¿°ç¬¦çš„ç¼–å·")]),s._v(" "),t("li",[s._v("eventsï¼šåœ¨æ„çš„äº‹ä»¶ï¼Œè¯»ã€å†™æˆ–æ˜¯å¼‚å¸¸ï¼Œè¿™é‡Œæˆ‘ä»¬åªè€ƒè™‘è¯»äº‹ä»¶ï¼Œè®¾ç½®è¯¥å€¼ä¸ºå¸¸é‡ POLLIN")]),s._v(" "),t("li",[s._v("reventsï¼šå¯¹ events çš„å›é¦ˆï¼Œåˆå§‹å€¼ä¸º 0")])]),s._v(" "),t("h3",{attrs:{id:"ä¸¾ä¾‹è¯´æ˜-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸¾ä¾‹è¯´æ˜-2"}},[s._v("#")]),s._v(" ä¸¾ä¾‹è¯´æ˜")]),s._v(" "),t("p",[s._v("â­  æˆ‘ä»¬ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ºæ¡ˆä¾‹æ¥äº†è§£ pollï¼Œæˆ‘ä»¬å°†é€æ­¥åˆ†ææ¯ä¸€éƒ¨åˆ†")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    addrlen "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    pollfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sockaddr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("addrlen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    pollfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("events "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" POLLIN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"round again"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("poll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pollfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pollfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("revents "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" POLLIN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            pollfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("revents "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MAXBUF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pollfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MAXBUF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("â­ "),t("strong",[s._v("ç¬¬ä¸€éƒ¨åˆ†")]),s._v("ï¼šæ„é€  pollfds æ•°ç»„")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    addrlen "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    pollfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sockaddr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("addrlen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¾ç½®å…³æ³¨çš„äº‹ä»¶ä¸ºè¯»äº‹ä»¶")]),s._v("\n    pollfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("events "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" POLLIN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("è¿™é‡Œå‡è®¾æœ‰ 5 ä¸ª socket è¿æ¥ï¼Œå°±æ˜¯ 5 ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚å¹¶å°†æ‰€æœ‰çš„æ–‡ä»¶æè¿°ç¬¦æ”¾è¿› pollfds æ•°ç»„ä¸­ï¼Œå¹¶è®¾ç½®å…³æ³¨çš„äº‹ä»¶ä¸ºè¯»äº‹ä»¶ã€‚")]),s._v(" "),t("p",[s._v("â­ "),t("strong",[s._v("ç¬¬äºŒéƒ¨åˆ†")]),s._v("ï¼šè°ƒç”¨ poll æ–¹æ³•")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"round again"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä¸ select ä¸€æ ·ï¼Œpollä¹Ÿæ˜¯é˜»å¡å‡½æ•°")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("poll")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pollfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ¤æ–­ revents æ˜¯å¦è¢«ç½®ä½")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pollfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("revents "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" POLLIN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// revents æ¸…é›¶")]),s._v("\n            pollfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("revents "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MAXBUF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pollfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MAXBUF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("ä¸ select ä¸€æ ·ï¼Œpoll ä¹Ÿæ˜¯é˜»å¡å‡½æ•°ï¼Œå½“æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶å‡†å¤‡å¥½åä¼šå°† pollfd ç»“æ„ä½“ä¸­çš„ revents ç½®ä½ï¼ˆreventå­—æ®µä» 0 å˜ä¸º 1ï¼‰å¹¶è¿”å›ã€‚")]),s._v(" "),t("p",[s._v("é€šè¿‡ for å¾ªç¯éå†ï¼Œåˆ¤æ–­ pollfds[i] ä¸­çš„ revents æ˜¯å¦è¢«ç½®ä½ï¼Œå¦‚æœç½®ä½çš„è¯å°±è¯»å–æ•°æ®å¹¶å¤„ç†ã€‚åŒæ—¶ï¼Œè¿˜éœ€è¦å°† revents æ¢å¤ä¸º 0ï¼Œ è¿™æ ·å°±ä¸éœ€è¦åœ¨æ¯æ¬¡å¾ªç¯å¼€å§‹çš„æ—¶å€™å¯¹ pollfds æ•°ç»„è¿›è¡Œé‡æ–°èµ‹å€¼ã€‚åœ¨ select ä¸­ï¼Œæ¯æ¬¡å¾ªç¯å¼€å§‹éƒ½éœ€è¦å¯¹ rset ä½å›¾è¿›è¡Œé‡æ–°èµ‹å€¼ã€‚")]),s._v(" "),t("h3",{attrs:{id:"poll-æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#poll-æ€»ç»“"}},[s._v("#")]),s._v(" poll æ€»ç»“")]),s._v(" "),t("p",[s._v("poll æ˜¯å¯¹ select çš„æ”¹è¿›ï¼Œè§£å†³äº† select çš„éƒ¨åˆ†ç¼ºç‚¹")]),s._v(" "),t("ul",[t("li",[s._v("ä½¿ç”¨ selectï¼Œrset ä½å›¾é»˜è®¤ä¸º 1024 ä½ï¼›ä½¿ç”¨ pollï¼Œå®šä¹‰çš„ pollfds æ•°ç»„çš„å¤§å°å¯ä»¥è®¾ç½®éå¸¸å¤§ ï¼ˆâˆšï¼‰")]),s._v(" "),t("li",[s._v("ä½¿ç”¨ selectï¼Œrset ä½å›¾æ¯æ¬¡å¾ªç¯éƒ½è¦é‡æ–°èµ‹å€¼ï¼›ä½¿ç”¨ pollï¼Œå®šä¹‰çš„ pollfds æ•°ç»„å¯ä»¥æŒç»­ä½¿ç”¨ï¼Œå¯¹äºå¤„ç†å¥½çš„æ•°æ®åªéœ€è¦ä»¤ revents ä¸º 0 å³å¯ ï¼ˆâˆšï¼‰")]),s._v(" "),t("li",[s._v("ä½¿ç”¨ selectï¼Œrset ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€éœ€è¦å¼€é”€ï¼›ä½¿ç”¨ pollï¼Œä¹Ÿéœ€è¦æ‹·è´ pollfds æ•°ç»„ ï¼ˆÃ—ï¼‰")]),s._v(" "),t("li",[s._v("ä½¿ç”¨ selectï¼Œè¿”å›åæˆ‘ä»¬è¿˜éœ€è¦å»éå†æ‰€æœ‰ fd å»åˆ¤æ–­å“ªä¸ªæ•°æ®å‡†å¤‡å¥½äº†ï¼›ä½¿ç”¨ pollï¼ŒåŒæ ·éœ€è¦åˆ¤æ–­ pollfds æ•°ç»„ ï¼ˆÃ—ï¼‰")])]),s._v(" "),t("h2",{attrs:{id:"epoll"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#epoll"}},[s._v("#")]),s._v(" epoll")]),s._v(" "),t("p",[s._v("epoll æ˜¯åœ¨ 2.6 å†…æ ¸ä¸­æå‡ºçš„ï¼Œæ˜¯ä¹‹å‰çš„ select å’Œ poll çš„å¢å¼ºç‰ˆæœ¬ã€‚ç›¸å¯¹äº select å’Œ poll æ¥è¯´ï¼Œ epoll æ›´åŠ çµæ´»ï¼Œ æ²¡æœ‰æè¿°ç¬¦é™åˆ¶ã€‚epoll ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦ï¼Œå°†ç”¨æˆ·å…³å¿ƒçš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œè¿™æ ·åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„ copy åªéœ€ä¸€æ¬¡ã€‚")]),s._v(" "),t("p",[s._v("epoll æ“ä½œè¿‡ç¨‹éœ€è¦ä¸‰ä¸ªæ¥å£ï¼Œåˆ†åˆ«å¦‚ä¸‹:")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("<sys/epol.h>")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("epoll_create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("epoll_ctl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" epfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" op"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("epoll_event")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("epoll_wait")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" epfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("epoll_event")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" maxevents"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"epoll-api-è¯´æ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#epoll-api-è¯´æ˜"}},[s._v("#")]),s._v(" epoll API è¯´æ˜")]),s._v(" "),t("p",[s._v("â­ "),t("strong",[s._v("epoll_create")])]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("epoll_create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("epoll_create")]),s._v(" å‡½æ•°æ˜¯ä¸€ä¸ªç³»ç»Ÿå‡½æ•°ï¼Œ å‡½æ•°å°†åœ¨å†…æ ¸ç©ºé—´å†…å¼€è¾Ÿä¸€å—æ–°çš„ç©ºé—´ï¼Œå¯ä»¥ç†è§£ä¸º epoll ç»“æ„ç©ºé—´ï¼Œ è¿”å›å€¼ä¸º epoll çš„æ–‡ä»¶æè¿°ç¬¦ç¼–å·ï¼Œæ–¹ä¾¿åç»­æ“ä½œä½¿ç”¨ã€‚è¯¥ç©ºé—´ä½¿ç”¨çš„æ˜¯çº¢é»‘æ ‘ï¼Œepfd æ˜¯çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚")]),s._v(" "),t("p",[s._v("â­ "),t("strong",[s._v("epoll_ctl")])]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("epoll_ctl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" epfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" op"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("epoll_event")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("event"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("epoll_ctl")]),s._v(" æ˜¯ epoll çš„äº‹ä»¶æ³¨å†Œå‡½æ•°ï¼Œepoll ä¸ select ä¸åŒï¼Œ select å‡½æ•°æ˜¯è°ƒç”¨æ—¶æŒ‡å®šéœ€è¦ç›‘å¬çš„æè¿°ç¬¦å’Œäº‹ä»¶ï¼Œepoll å…ˆå°†ç”¨æˆ·æ„Ÿå…´è¶£çš„æè¿°ç¬¦äº‹ä»¶æ³¨å†Œåˆ° epoll ç©ºé—´å†…ï¼Œæ­¤å‡½æ•°æ˜¯éé˜»å¡å‡½æ•°ï¼Œä½œç”¨ä»…ä»…æ˜¯å¢åˆ æ”¹ epoll ç©ºé—´å†…çš„æè¿°ç¬¦ä¿¡æ¯ã€‚")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("epfdï¼šepoll ç»“æ„çš„è¿›ç¨‹ fd ç¼–å·ï¼Œå‡½æ•°å°†ä¾é è¯¥ç¼–å·æ‰¾åˆ°å¯¹åº”çš„ epoll ç»“æ„ã€‚")])]),s._v(" "),t("li",[t("p",[s._v("opï¼šè¡¨ç¤ºå½“å‰è¯·æ±‚ç±»å‹ï¼ˆå¢ã€åˆ ã€æ”¹ï¼‰ï¼Œç”±ä¸‰ä¸ªå®å®šä¹‰")]),s._v(" "),t("ul",[t("li",[s._v("EPOLL_CTL_ADDï¼šæ³¨å†Œæ–°çš„ fd åˆ° epfd ä¸­")]),s._v(" "),t("li",[s._v("EPOLL_CTL_MODï¼šä¿®æ”¹å·²ç»æ³¨å†Œçš„ fd çš„ç›‘å¬äº‹ä»¶")]),s._v(" "),t("li",[s._v("EPOLL_CTL_DELï¼šä» epfd ä¸­åˆ é™¤ä¸€ä¸ª fd")])])]),s._v(" "),t("li",[t("p",[s._v("fdï¼šéœ€è¦ç›‘å¬çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ä¸€èˆ¬æŒ‡ socket fd")])]),s._v(" "),t("li",[t("p",[s._v("eventï¼šå‘Šè¯‰å†…æ ¸å¯¹è¯¥fdèµ„æºæ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("epoll")]),s._v(" event "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("uint32_t")]),s._v(" events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Epoll events */")]),s._v("\n    epoll_data_t data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* User data variable */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("events å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ä¸ªå®çš„é›†åˆ:")]),s._v(" "),t("p",[s._v("EPOLLINã€EPOLLOUTã€ EPOLLPRIã€ EPOLLERRã€ EPOLLHUP (æŒ‚æ–­)ã€EPOLLET (è¾¹ç¼˜è§¦å‘)ã€EPOLLONESHOT (åªç›‘å¬ä¸€æ¬¡ï¼Œäº‹ä»¶è§¦å‘åè‡ªåŠ¨ä» epoll  åˆ—è¡¨ä¸­æ¸…é™¤è¯¥ fdï¼‰")])])]),s._v(" "),t("p",[s._v("â­ "),t("strong",[s._v("epoll_wait")])]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("epoll_wait")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" epfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("epoll_event")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" maxevents"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("epoll_wait")]),s._v(" ç­‰å¾…äº‹ä»¶çš„äº§ç”Ÿï¼Œç±»ä¼¼äº select è°ƒç”¨ã€‚æ ¹æ®å‚æ•° timeout æ¥å†³å®šæ˜¯å¦é˜»å¡")]),s._v(" "),t("ul",[t("li",[s._v("epfdï¼šæŒ‡å®šæ„Ÿå…´è¶£çš„ epoll äº‹ä»¶åˆ—è¡¨")]),s._v(" "),t("li",[s._v("eventsï¼šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå¿…é¡»æŒ‡å‘ä¸€ä¸ª epoll_event ç»“æ„æ•°ç»„ï¼Œå½“å‡½æ•°è¿”å›æ—¶ï¼Œå†…æ ¸ä¼šæŠŠå°±ç»ªçŠ¶æ€çš„æ•°æ®æ‹·è´åˆ°è¯¥æ•°ç»„ä¸­")]),s._v(" "),t("li",[s._v("maxeventsï¼šè¡¨æ˜å‚æ•°äºŒ epoll_event æ•°ç»„æœ€å¤šèƒ½æ¥æ”¶çš„æ•°æ®é‡ï¼Œå³æœ¬æ¬¡æ“ä½œæœ€å¤šèƒ½è·å–å¤šå°‘å°±ç»ªæ•°æ®")]),s._v(" "),t("li",[s._v("timeoutï¼šå•ä½ä¸ºæ¯«ç§’ã€‚\n"),t("ul",[t("li",[s._v("0ï¼šéé˜»å¡è°ƒç”¨ï¼Œè¡¨ç¤ºç«‹å³è¿”å›")]),s._v(" "),t("li",[s._v("-1ï¼šé˜»å¡è°ƒç”¨ï¼Œç›´åˆ°æœ‰ç”¨æˆ·æ„Ÿå…´è¶£çš„äº‹ä»¶å°±ç»ªä¸ºæ­¢")]),s._v(" "),t("li",[s._v("å…¶ä»–ï¼šé˜»å¡è°ƒç”¨ï¼Œé˜»å¡æŒ‡å®šæ—¶é—´å†…å¦‚æœæœ‰äº‹ä»¶å°±ç»ªåˆ™æå‰è¿”å›ï¼Œå¦åˆ™ç­‰å¾…æŒ‡å®šæ—¶é—´åè¿”å›")])])]),s._v(" "),t("li",[s._v("è¿”å›å€¼ï¼šæœ¬æ¬¡å°±ç»ªçš„ fd ä¸ªæ•°")])]),s._v(" "),t("p",[s._v("â­ "),t("strong",[s._v("å·¥ä½œæ¨¡å¼")])]),s._v(" "),t("p",[s._v("epoll å¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§æ¨¡å¼ï¼šLTï¼ˆæ°´å¹³è§¦å‘ï¼‰å’Œ ETï¼ˆè¾¹ç¼˜è§¦å‘ï¼‰ã€‚LT æ¨¡å¼æ˜¯é»˜è®¤æ¨¡å¼ï¼ŒLT æ¨¡å¼ä¸ ET æ¨¡å¼çš„åŒºåˆ«å¦‚ä¸‹")]),s._v(" "),t("ul",[t("li",[s._v("LTï¼ˆæ°´å¹³è§¦å‘ï¼‰ï¼šäº‹ä»¶å°±ç»ªåï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©å¤„ç†æˆ–è€…ä¸å¤„ç†ï¼Œå¦‚æœç”¨æˆ·æœ¬æ¬¡æœªå¤„ç†ï¼Œé‚£ä¹ˆä¸‹æ¬¡è°ƒç”¨ epoll wait æ—¶ä»ç„¶ä¼šå°†æœªå¤„ç†çš„äº‹ä»¶æ‰“åŒ…ç»™ä½ ã€‚")]),s._v(" "),t("li",[s._v("ETï¼ˆè¾¹ç¼˜è§¦å‘ï¼‰ï¼šäº‹ä»¶å°±ç»ªåï¼Œç”¨æˆ·å¿…é¡»å¤„ç†ï¼Œå› ä¸ºå†…æ ¸ä¸ç»™ä½ å…œåº•äº†ï¼Œå†…æ ¸æŠŠå°±ç»ªçš„äº‹ä»¶æ‰“åŒ…ç»™ä½ åï¼Œå°±æŠŠå¯¹åº”çš„å°±ç»ªäº‹ä»¶æ¸…ç†æ‰äº†ã€‚")])]),s._v(" "),t("p",[s._v("ET æ¨¡å¼åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº† epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚")]),s._v(" "),t("h3",{attrs:{id:"ä¸¾ä¾‹è¯´æ˜-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸¾ä¾‹è¯´æ˜-3"}},[s._v("#")]),s._v(" ä¸¾ä¾‹è¯´æ˜")]),s._v(" "),t("p",[s._v("ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ºæ¡ˆä¾‹æ¥äº†è§£ epollï¼Œè¿™é‡Œå‡è®¾æœ‰ 5 ä¸ª socket è¿æ¥")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("epoll_event")]),s._v(" events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// epoll å‡†å¤‡å¥½çš„æ•°æ®å°†æ”¾åœ¨è¿™é‡Œ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" epfd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("epoll_create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å†…å­˜ä¸­å¼€è¾Ÿä¸€å—åŒºåŸŸï¼Œç›‘å¬åˆ—è¡¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("epoll_event")]),s._v(" ev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    addrlen "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sockaddr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("addrlen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("events "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" EPOLLIN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è§¦å‘æ–¹å¼ï¼šè¯»è§¦å‘")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("epoll_ctl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("epfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" EPOLL_CTL_ADD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("ev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"round again"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    nfds "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("epoll_wait")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("epfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("nfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MAXBUF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MAXBUF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("â­ "),t("strong",[s._v("ç¬¬ä¸€éƒ¨åˆ†")]),s._v("ï¼šåˆ›å»º events æ•°ç»„")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("epoll_event")]),s._v(" events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" epfd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("epoll_create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("code",[s._v("epoll_create()")]),s._v(" å‡½æ•°åœ¨å‰é¢ä»‹ç»è¿‡ï¼Œåœ¨å†…æ ¸ç©ºé—´å†…å¼€è¾Ÿä¸€å—æ–°çš„ç©ºé—´ï¼Œæˆ‘ä»¬æš‚ä¸”ç§°å…¶ä¸ºç›‘å¬åˆ—è¡¨ã€‚è¯¥ç©ºé—´ç»“æ„ä¸ºçº¢é»‘æ ‘ï¼Œepfd æ˜¯çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œæ­¤æ—¶ size ä¸º 10ï¼Œå¯ä»¥å­˜å‚¨ 10 ä¸ª fdã€‚")]),s._v(" "),t("p",[s._v("â­ "),t("strong",[s._v("ç¬¬äºŒéƒ¨åˆ†")]),s._v("ï¼šæ·»åŠ äº‹ä»¶åˆ° events æ•°ç»„")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// äº‹ä»¶ä»¥ epoll_event ç»“æ„ä½“çš„å½¢å¼å­˜åœ¨")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("epoll_event")]),s._v(" ev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    addrlen "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sockfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sockaddr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("addrlen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŒ‡æ˜äº‹ä»¶è§¦å‘æ–¹å¼ï¼Œè¯»è§¦å‘")]),s._v("\n    ev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("events "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" EPOLLIN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ·»åŠ  fd åˆ° events ä¸­")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("epoll_ctl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("epfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" EPOLL_CTL_ADD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("ev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("å°† 5 ä¸ª epoll_event ç»“æ„ä½“æ·»åŠ åˆ°ç›‘å¬åˆ—è¡¨ä¸­ï¼Œepoll_event è·Ÿä¹‹å‰ä»‹ç»çš„ pollfd å¾ˆåƒã€‚")]),s._v(" "),t("p",[s._v("â­ "),t("strong",[s._v("ç¬¬ä¸‰éƒ¨åˆ†")]),s._v("ï¼šæ‰§è¡Œ epoll")]),s._v(" "),t("div",{staticClass:"language-cpp line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-cpp"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"round again"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    nfds "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("epoll_wait")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("epfd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("nfds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MAXBUF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MAXBUF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("puts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[t("code",[s._v("epoll_wait(epfd, events, 5, 10000)")]),s._v("ï¼šä¼ å…¥ç›‘å¬åˆ—è¡¨é˜»å¡ç­‰å¾…æ•°æ®æ˜¯å¦å‡†å¤‡å®Œæ¯•")]),s._v(" "),t("p",[s._v("å½“ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å‡†å¤‡å®Œæ¯•åï¼Œå‡†å¤‡å¥½çš„æ•°æ®å°±ä¼šæ”¾åˆ°ä¸€ä¸ª events æ•°ç»„ä¸­ï¼Œå¹¶è¿”å› ndfs ä¹Ÿå°±æ˜¯å‡†å¤‡å¥½çš„æ–‡ä»¶ä¸ªæ•°ã€‚ä¹‹åæ ¹æ® ndfs å†³å®šéå†çš„æ¬¡æ•°ï¼Œè¯»å–æ•°æ®å¹¶å¤„ç†ã€‚")]),s._v(" "),t("h3",{attrs:{id:"epoll-æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#epoll-æ€»ç»“"}},[s._v("#")]),s._v(" epoll æ€»ç»“")]),s._v(" "),t("p",[s._v("æˆ‘ä»¬å°†å…¨éƒ¨çš„æ–‡ä»¶æè¿°ç¬¦æ”¶é›†è¿‡æ¥æ”¾åˆ° nfds æŒ‡å‘çš„å†…æ ¸çš„ä¸€å—åŒºåŸŸï¼Œå†…æ ¸å¸®æˆ‘ä»¬éå†å“ªäº›æ•°æ®å·²ç»å‡†å¤‡å¥½äº†ï¼Œå½“å…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å‡†å¤‡å¥½åï¼Œä¼šæ‹·è´åˆ° events æ•°ç»„å½“ä¸­ï¼Œepoll å‡½æ•°ä¼šè¿”å›å°±ç»ªçš„ä¸ªæ•°ï¼Œæ ¹æ®å°±ç»ªçš„æ–‡ä»¶ä¸ªæ•°éå† events æ•°ç»„ï¼Œå¯¹å‡†å¤‡å¥½çš„æ•°æ®è¿›è¡Œè¯»å–å’Œå¤„ç†ã€‚")]),s._v(" "),t("p",[s._v("ä¸ select å¯¹æ¯”")]),s._v(" "),t("ol",[t("li",[s._v("selectï¼Œrset ä½å›¾çš„é»˜è®¤å¤§å°ä¸º 1024ï¼›epollï¼Œepoll_create() å‡½æ•°å¼€è¾Ÿçš„å†…å­˜åŒºåŸŸå¯ä»¥å¾ˆå¤§ã€‚")]),s._v(" "),t("li",[s._v("selectï¼Œrset ä½å›¾ä¸å¯é‡ç”¨ï¼›epollï¼Œnfds æŒ‡å‘çš„å†…å­˜åŒºåŸŸå¯ä»¥åå¤ä½¿ç”¨")]),s._v(" "),t("li",[s._v("selectï¼Œrset ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€éœ€è¦å¼€é”€ï¼›epollï¼Œè¿™ä¸ªåœ°æ–¹ä¹Ÿæ˜¯æœ‰ä¼˜åŒ–ï¼Œä½†æ˜¯æˆ‘ä¹Ÿæ²¡æœ‰ç†è§£æ˜ç™½ã€‚")]),s._v(" "),t("li",[s._v("select ï¼Œæˆ‘ä»¬éœ€è¦éå† fds æ¥åˆ¤æ–­å“ªäº›æ•°æ®å·²ç»å‡†å¤‡å¥½ï¼›epollï¼Œç›´æ¥å¤„ç† events æ•°ç»„ï¼Œé‡Œé¢éƒ½æ˜¯å‡†å¤‡å¥½çš„æ•°æ®ã€‚")])])])}),[],!1,null,null,null);t.default=e.exports}}]);