(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{431:function(s,t,a){"use strict";a.r(t);var n=a(8),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"redisåº•å±‚æ•°æ®ç»“æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redisåº•å±‚æ•°æ®ç»“æ„"}},[s._v("#")]),s._v(" Redisåº•å±‚æ•°æ®ç»“æ„")]),s._v(" "),t("p",[s._v("å†…å®¹å‚è€ƒï¼šã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹")]),s._v(" "),t("h2",{attrs:{id:"_1-ç®€å•åŠ¨æ€å­—ç¬¦ä¸²"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ç®€å•åŠ¨æ€å­—ç¬¦ä¸²"}},[s._v("#")]),s._v(" 1. ç®€å•åŠ¨æ€å­—ç¬¦ä¸²")]),s._v(" "),t("p",[s._v("Redisæ²¡æœ‰ç›´æ¥ä½¿ç”¨ C è¯­è¨€ä¼ ç»Ÿçš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼ˆä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦æ•°ç»„ï¼Œä¸€ä¸‹ç®€ç§°Cå­—ç¬¦ä¸²ï¼‰ï¼Œè€Œæ˜¯æ„å»ºäº†ä¸€ç§åä¸º"),t("strong",[s._v("ç®€å•åŠ¨æ€å­—ç¬¦ä¸²")]),s._v("ï¼ˆSimple Dynamic Stringï¼ŒSDSï¼‰çš„æŠ½è±¡ç±»å‹ã€‚")]),s._v(" "),t("h3",{attrs:{id:"_1-1-sdså®šä¹‰"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-sdså®šä¹‰"}},[s._v("#")]),s._v(" 1.1 SDSå®šä¹‰")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sdshdr")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" len"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" free"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" buf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("lenï¼šè®°å½• buf æ•°ç»„ä¸­å·²ä½¿ç”¨å­—èŠ‚çš„æ•°é‡ï¼Œç­‰äº SDS æ‰€ä¿å­˜å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚")]),s._v(" "),t("li",[s._v("freeï¼šè®°å½• buf æ•°ç»„ä¸­æœªä½¿ç”¨å­—èŠ‚çš„æ•°é‡ã€‚")]),s._v(" "),t("li",[s._v("buf[]ï¼šå­—èŠ‚æ•°ç»„ï¼Œç”¨äºä¿å­˜å­—ç¬¦ä¸²ã€‚")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs/redis-sds1.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),s._v(" "),t("ul",[t("li",[s._v("free å±æ€§å€¼ä¸º 5ï¼šè¡¨ç¤º SDS åˆ†é… 5 å­—èŠ‚æœªä½¿ç”¨ç©ºé—´ã€‚")]),s._v(" "),t("li",[s._v("len å±æ€§å€¼ä¸º 5ï¼šè¡¨ç¤º SDS ä¿å­˜ä¸€ä¸ª 5 å­—èŠ‚é•¿çš„å­—ç¬¦ä¸²ã€‚")]),s._v(" "),t("li",[s._v("buf å±æ€§æ˜¯ä¸€ä¸ª char ç±»å‹çš„æ•°ç»„ï¼Œä¿å­˜äº† 5 ä¸ªå­—ç¬¦å’Œ 1 ä¸ªç©ºå­—ç¬¦"),t("code",[s._v("\\0")]),s._v("ï¼Œåé¢ç”± 5 å­—èŠ‚æœªä½¿ç”¨ç©ºé—´ã€‚é•¿åº¦ä¸º "),t("code",[s._v("5 + 5 + 1 = 11")])])]),s._v(" "),t("h3",{attrs:{id:"_1-2-sdsä¸cå­—ç¬¦ä¸²åŒºåˆ«"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-sdsä¸cå­—ç¬¦ä¸²åŒºåˆ«"}},[s._v("#")]),s._v(" 1.2 SDSä¸Cå­—ç¬¦ä¸²åŒºåˆ«")]),s._v(" "),t("p",[s._v("C è¯­è¨€ä½¿ç”¨åä¸º N+1 çš„å­—ç¬¦æ•°ç»„è¡¨ç¤ºé•¿åº¦ä¸º N çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å­—ç¬¦æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ æ€»æ˜¯ç©ºå­—ç¬¦ "),t("code",[s._v("\\0")]),s._v("ã€‚")]),s._v(" "),t("p",[s._v("ğŸ”¶ "),t("strong",[s._v("å¸¸æ•°å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦")])]),s._v(" "),t("p",[s._v("C å­—ç¬¦ä¸²ä¸è®°å½•è‡ªèº«çš„é•¿åº¦ä¿¡æ¯ï¼Œæ‰€ä»¥è·å–ä¸€ä¸ª C å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç¨‹åºå¿…é¡»éå†æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(N)ã€‚")]),s._v(" "),t("p",[s._v("SDS åœ¨ len å±æ€§ä¸­è®°å½•äº† SDS æœ¬èº«çš„é•¿åº¦ï¼Œè·å– SDS é•¿åº¦çš„çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1).")]),s._v(" "),t("p",[s._v("ğŸ”¶ "),t("strong",[s._v("æœç»ç¼“å†²åŒºæº¢å‡º")])]),s._v(" "),t("p",[s._v("C å­—ç¬¦ä¸²ä¸è®°å½•è‡ªèº«é•¿åº¦å¸¦æ¥çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯å®¹æ˜“é€ æˆç¼“å†²åŒºæº¢å‡ºï¼ˆBuffer Overflowï¼‰ã€‚")]),s._v(" "),t("blockquote",[t("p",[s._v("ä¸¾ä¸ªä¾‹å­ï¼Œä¸¤ä¸ªç›¸é‚»å†…å­˜ä¸­å­˜æ”¾Cå­—ç¬¦ä¸²s1å’Œs2ï¼Œs1ä¿å­˜å­—ç¬¦ä¸²"),t("code",[s._v("redis")]),s._v("ï¼Œs2ä¿å­˜å­—ç¬¦ä¸²"),t("code",[s._v("mongoDB")]),s._v("ï¼Œå¦‚æœæ­¤æ—¶å°†s1å†…å®¹ä¿®æ”¹ä¸º"),t("code",[s._v("Redis Cluster")]),s._v("è€Œå¿˜è®°åˆ†é…è¶³å¤Ÿçš„ç©ºé—´ï¼Œé‚£ä¹ˆs1çš„æ•°æ®å°†æº¢å‡ºåˆ°s2æ‰€åœ¨çš„ç©ºé—´ï¼Œå¯¼è‡´s2è¢«ä¿®æ”¹ã€‚")])]),s._v(" "),t("p",[s._v("SDS ç©ºé—´åˆ†é…ç­–ç•¥å®Œå…¨æœç» äº†å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºçš„å¯èƒ½æ€§ï¼Œå½“éœ€è¦å¯¹ SDS è¿›è¡Œä¿®æ”¹æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ SDS ç©ºé—´æ˜¯å¦æ»¡è¶³ä¿®æ”¹æ‰€éœ€çš„è¦æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ä¼šè‡ªåŠ¨æ‰©å±•ç©ºé—´åˆ°éœ€è¦çš„å¤§å°åå†è¿›è¡Œä¿®æ”¹ã€‚")]),s._v(" "),t("p",[s._v("ğŸ”¶ "),t("strong",[s._v("å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å¸¦æ¥çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°")])]),s._v(" "),t("p",[s._v("æ¯æ¬¡å¢é•¿æˆ–ç¼©çŸ­ä¸€ä¸ªCå­—ç¬¦ä¸²ï¼Œç¨‹åºéƒ½è¦å¯¹ä¿å­˜è¿™ä¸ªCå­—ç¬¦ä¸²çš„æ•°ç»„è¿›è¡Œä¸€æ¬¡å†…å­˜é‡æ–°åˆ†é…ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("åœ¨æ“ä½œä¹‹å‰ï¼Œéœ€è¦é€šè¿‡å†…å­˜é‡åˆ†é…æ¥æ‰©å±•åº•å±‚æ•°ç»„ç©ºé—´å¤§å°ï¼Œå¦åˆ™ä¼šäº§ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚")]),s._v(" "),t("li",[s._v("ç¼©çŸ­å­—ç¬¦æ“ä½œï¼šåœ¨æ“ä½œä¹‹åï¼Œéœ€è¦é€šè¿‡å†…å­˜é‡åˆ†é…æ¥é‡Šæ”¾ä¸å†ä½¿ç”¨çš„ç©ºé—´ï¼Œå¦åˆ™ä¼šäº§ç”Ÿå†…å­˜æ³„éœ²ã€‚")])]),s._v(" "),t("blockquote",[t("p",[s._v("å†…å­˜é‡åˆ†é…è®¾è®¡å¤æ‚çš„ç®—æ³•ï¼Œå¯èƒ½éœ€è¦æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œéå¸¸è€—æ—¶ã€‚åœ¨Redisä¸­ï¼Œéœ€è¦ç»å¸¸ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å¯¹é€Ÿåº¦è¦æ±‚è‹›åˆ»ï¼Œå¦‚æœæ¯æ¬¡ä¿®æ”¹å­—ç¬¦ä¸²éƒ½è¦å†…å­˜é‡åˆ†é…çš„è¯ï¼Œä¼šå¯¹æ•´ä½“çš„æ€§èƒ½é€ æˆå½±å“ã€‚")])]),s._v(" "),t("p",[s._v("SDSé€šè¿‡"),t("strong",[s._v("æœªä½¿ç”¨ç©ºé—´")]),s._v("è§£é™¤äº†å­—ç¬¦ä¸²é•¿åº¦å’Œåº•å±‚æ•°ç»„é•¿åº¦ä¹‹é—´çš„å…³è”ã€‚SDSå®ç°äº†"),t("strong",[s._v("ç©ºé—´é¢„åˆ†é…")]),s._v("å’Œ"),t("strong",[s._v("æƒ°æ€§ç©ºé—´")]),s._v("ä¸¤ç§ä¼˜åŒ–ç­–ç•¥ã€‚")]),s._v(" "),t("p",[s._v("â–¶ "),t("strong",[s._v("ç©ºé—´é¢„åˆ†é…")]),s._v("ï¼šç”¨äºä¼˜åŒ–å­—ç¬¦ä¸²å¢é•¿æ“ä½œ")]),s._v(" "),t("p",[s._v("å½“å¯¹SDSè¿›è¡Œä¿®æ”¹æ—¶ï¼ˆä¿®æ”¹åçš„å­—ç¬¦ä¸²é•¿åº¦å˜é•¿ï¼‰ï¼Œé¦–å…ˆä¼šæ£€æŸ¥æœªåˆ†é…ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œå¦‚æœè¶³å¤Ÿçš„è¯ï¼Œå°†ä½¿ç”¨æœªåˆ†é…ç©ºé—´ï¼Œè€Œä¸éœ€è¦ç©ºé—´æ‰©å±•ã€‚å¦‚æœç©ºé—´ä¸å¤Ÿçš„è¯ï¼Œéœ€è¦è¿›è¡Œç©ºé—´æ‰©å±•ï¼Œç¨‹åºä¸ä»…ä¼šåˆ†é…æ‰€éœ€çš„å¿…é¡»ç©ºé—´ï¼Œè¿˜ä¼šåˆ†é…é¢å¤–çš„ç©ºé—´ã€‚é€šè¿‡é¢„åˆ†é…ç­–ç•¥ï¼ŒSDSå°†è¿ç»­å¢é•¿Næ¬¡å­—ç¬¦ä¸²æ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°ä»å¿…å®šNæ¬¡é™ä½ä¸ºæœ€å¤šNæ¬¡ã€‚")]),s._v(" "),t("p",[s._v("â–¶ "),t("strong",[s._v("æƒ°æ€§ç©ºé—´é‡Šæ”¾")]),s._v("ï¼šç”¨äºä¼˜åŒ–å­—ç¬¦ä¸²ç¼©çŸ­æ“ä½œ")]),s._v(" "),t("p",[s._v("å½“SDSç¼©çŸ­æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³ä½¿ç”¨å†…å­˜é‡åˆ†é…æ¥å›æ”¶ç¼©çŸ­åå¤šå‡ºæ¥çš„å­—èŠ‚ï¼Œè€Œæ˜¯ä½¿ç”¨freeå±æ€§å°†è¿™äº›å­—èŠ‚çš„æ•°é‡è®°å½•èµ·æ¥ï¼Œä¸ºå°†æ¥å¯èƒ½æœ‰çš„å¢é•¿æ“ä½œæä¾›äº†ä¼˜åŒ–ã€‚\nSDSæä¾›ç›¸åº”çš„APIï¼Œåœ¨æˆ‘ä»¬æœ‰éœ€è¦æ—¶ï¼ŒçœŸæ­£åœ°é‡Šæ”¾SDSçš„æœªä½¿ç”¨ç©ºé—´ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‹…å¿ƒæƒ°æ€§ç©ºé—´é‡Šæ”¾ç­–ç•¥ä¼šé€ æˆå†…å­˜æµªè´¹ã€‚")]),s._v(" "),t("p",[s._v("ğŸ”¶ "),t("strong",[s._v("äºŒè¿›åˆ¶å®‰å…¨")])]),s._v(" "),t("p",[s._v("Cå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦å¿…é¡»ç¬¦åˆç¼–ç è¦æ±‚ï¼Œé™¤äº†å­—ç¬¦ä¸²çš„æœ«å°¾å¤–ï¼Œå­—ç¬¦ä¸²é‡Œé¢ä¸èƒ½åŒ…å«ç©ºå­—ç¬¦ï¼Œå¦åˆ™æœ€å…ˆè¢«ç¨‹åºè¯»å…¥çš„ç©ºå­—ç¬¦å°†è¢«è¯¯è®¤ä¸ºæ˜¯å­—ç¬¦ä¸²ç»“å°¾ï¼Œè¿™äº›é™åˆ¶ä½¿å¾—Cå­—ç¬¦ä¸²åªèƒ½ä¿å­˜æ–‡æœ¬æ•°æ®ï¼Œè€Œä¸èƒ½ä¿å­˜å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ã€å‹ç¼©æ–‡ä»¶è¿™æ ·çš„äºŒè¿›åˆ¶æ•°æ®ã€‚")]),s._v(" "),t("p",[s._v("ä¸ºäº†ç¡®ä¿Rediså¯ä»¥é€‚ç”¨äºå„ç§ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œä¸ä»…å¯ä»¥ä¿å­˜æ–‡æœ¬æ•°æ®ï¼Œè¿˜å¯ä»¥ä¿å­˜ä»»æ„æ ¼å¼çš„äºŒè¿›åˆ¶æ•°æ®ã€‚SDSçš„APIæ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œç¨‹åºä¸ä¼šå¯¹æ•°æ®åšä»»ä½•å¤„ç†ï¼Œè¾“å…¥åœ¨å†™å…¥æ—¶æ˜¯ä»€ä¹ˆæ ·ï¼Œè¯»å‡ºæ¥å°±æ˜¯ä»€ä¹ˆæ ·ã€‚")]),s._v(" "),t("p",[s._v("ğŸ”¶ "),t("strong",[s._v("å…¼å®¹éƒ¨åˆ†Cå­—ç¬¦ä¸²å‡½æ•°")])]),s._v(" "),t("p",[s._v("SDS éµå¾ª C å­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ä¸²ç»“å°¾çš„ç®¡ç†ï¼Œè¿™æ ·å¯ä»¥é‡ç”¨ä¸€éƒ¨åˆ† "),t("code",[s._v("<string.h>")]),s._v(" åº“å®šä¹‰çš„å‡½æ•°ã€‚")]),s._v(" "),t("p",[s._v("ğŸ”· "),t("strong",[s._v("æ€»ç»“")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("Cå­—ç¬¦ä¸²")]),s._v(" "),t("th",[s._v("SDS")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(N)")]),s._v(" "),t("td",[s._v("è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)")])]),s._v(" "),t("tr",[t("td",[s._v("APIæ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½æ‰¾å‡ºç¼“å†²åŒºæº¢å‡º")]),s._v(" "),t("td",[s._v("APIæ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šæ‰¾å‡ºç¼“å†²åŒºæº¢å‡º")])]),s._v(" "),t("tr",[t("td",[s._v("ä¿®æ”¹å­—ç¬¦ä¸²é•¿åº¦Næ¬¡å¿…ç„¶æ‰§è¡ŒNæ¬¡å†…å­˜é‡åˆ†é…")]),s._v(" "),t("td",[s._v("ä¿®æ”¹å­—ç¬¦ä¸²é•¿åº¦Næ¬¡æœ€å¤šéœ€è¦æ‰§è¡ŒNæ¬¡å†…å­˜é‡åˆ†é…")])]),s._v(" "),t("tr",[t("td",[s._v("åªèƒ½ä¿å­˜æ–‡æœ¬æ•°æ®")]),s._v(" "),t("td",[s._v("å¯ä»¥ä¿å­˜æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ•°æ®")])]),s._v(" "),t("tr",[t("td",[s._v("å¯ä»¥ä½¿ç”¨æ‰€æœ‰"),t("code",[s._v("<string.h>")]),s._v("åº“ä¸­çš„å‡½æ•°")]),s._v(" "),t("td",[s._v("å¯ä»¥ä½¿ç”¨éƒ¨åˆ†"),t("code",[s._v("<string.h>")]),s._v("åº“ä¸­çš„å‡½æ•°")])])])]),s._v(" "),t("h2",{attrs:{id:"_2-é“¾è¡¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-é“¾è¡¨"}},[s._v("#")]),s._v(" 2. é“¾è¡¨")]),s._v(" "),t("p",[s._v("é“¾è¡¨æ•°æ®ç»“æ„ç”±"),t("strong",[s._v("é“¾è¡¨")]),s._v("å’Œ"),t("strong",[s._v("é“¾è¡¨èŠ‚ç‚¹")]),s._v("ä¸¤éƒ¨åˆ†ç»„æˆã€‚é€šè¿‡"),t("strong",[s._v("é“¾è¡¨")]),s._v("ç»“æ„ï¼Œä½¿é“¾è¡¨ã€é“¾è¡¨èŠ‚ç‚¹çš„æ“ä½œæ›´åŠ æ–¹ä¾¿ã€‚")]),s._v(" "),t("p",[s._v("ğŸ”¶ "),t("strong",[s._v("é“¾è¡¨èŠ‚ç‚¹")])]),s._v(" "),t("p",[s._v("é“¾è¡¨èŠ‚ç‚¹ä½¿ç”¨"),t("code",[s._v("adlist.h/listNode")]),s._v("ç»“æ„è¡¨ç¤º")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("listNode")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‰ç½®èŠ‚ç‚¹")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("listNode")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("prev"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åç½®èŠ‚ç‚¹")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("listNode")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// èŠ‚ç‚¹å€¼")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("listNode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("å¤šä¸ªlistNodeå¯ä»¥é€šè¿‡prevå’ŒnextæŒ‡é’ˆç»„æˆåŒç«¯é“¾è¡¨ã€‚")]),s._v(" "),t("p",[s._v("ğŸ”¶ "),t("strong",[s._v("é“¾è¡¨")])]),s._v(" "),t("p",[s._v("é“¾è¡¨ä½¿ç”¨"),t("code",[s._v("adlist.h/list")]),s._v("ç»“æ„è¡¨ç¤ºï¼š")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("list")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¡¨å¤´èŠ‚ç‚¹")]),s._v("\n\tlistNode "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("head"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¡¨å°¾èŠ‚ç‚¹")]),s._v("\n\tlistNode "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("tail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é“¾è¡¨æ‰€åŒ…å«çš„èŠ‚ç‚¹æ•°é‡")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" len"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// èŠ‚ç‚¹å€¼å¤åˆ¶å‡½æ•°")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("dup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("ptr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// èŠ‚ç‚¹å€¼é‡Šæ”¾å‡½æ•°")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("free"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("ptr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// èŠ‚ç‚¹å€¼å¯¹æ¯”å‡½æ•°")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("match"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("ptr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("æä¾›è¡¨å¤´æŒ‡é’ˆ headã€è¡¨ä½æŒ‡é’ˆ tailã€é“¾è¡¨é•¿åº¦è®¡æ•°å™¨ lenã€‚")]),s._v(" "),t("ul",[t("li",[s._v("dup å‡½æ•°ï¼šå¤åˆ¶é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼ã€‚")]),s._v(" "),t("li",[s._v("freeï¼šé‡Šæ”¾é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼ã€‚")]),s._v(" "),t("li",[s._v("matchï¼šå¯¹æ¯”é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼å’Œå¦ä¸€ä¸ªè¾“å…¥å€¼æ˜¯å¦ç›¸ç­‰ã€‚")])]),s._v(" "),t("p",[s._v("ğŸ”¶ "),t("strong",[s._v("ç»“æ„å›¾")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs/redis-linkedlist1.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),s._v(" "),t("p",[s._v("ğŸ”¶ "),t("strong",[s._v("ç‰¹æ€§")])]),s._v(" "),t("ul",[t("li",[s._v("åŒç«¯ï¼šé“¾è¡¨èŠ‚ç‚¹å¸¦æœ‰prevã€nextæŒ‡é’ˆï¼Œè·å–æŸä¸ªèŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹ã€‚")]),s._v(" "),t("li",[s._v("æ— ç¯ï¼šå¤´èŠ‚ç‚¹prevæŒ‡é’ˆå’Œå°¾èŠ‚ç‚¹nextæŒ‡é’ˆæŒ‡å‘NULLã€‚")]),s._v(" "),t("li",[s._v("å¸¦è¡¨å¤´æŒ‡é’ˆå’Œè¡¨ä½æŒ‡é’ˆï¼šé€šè¿‡listç»“æ„çš„headæŒ‡é’ˆå’ŒtailæŒ‡é’ˆè·å–é“¾è¡¨çš„è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚")]),s._v(" "),t("li",[s._v("å¸¦é“¾è¡¨é•¿åº¦è®¡æ•°å™¨ï¼šè·å–é“¾è¡¨ä¸­èŠ‚ç‚¹æ•°é‡çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚")]),s._v(" "),t("li",[s._v("å¤šæ€ï¼šé“¾è¡¨èŠ‚ç‚¹ä½¿ç”¨void*æŒ‡é’ˆæ¥ä¿å­˜èŠ‚ç‚¹å€¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡listç»“æ„çš„dupã€freeã€matchä¸‰ä¸ªå±æ€§ä¸ºèŠ‚ç‚¹å€¼è®¾ç½®ç±»å‹ç‰¹å®šå‡½æ•°ï¼Œæ‰€ä»¥é“¾è¡¨å¯ä»¥ç”¨äºä¿å­˜å„ç§ä¸åŒç±»å‹çš„å€¼ã€‚")])]),s._v(" "),t("h2",{attrs:{id:"_3-å­—å…¸"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-å­—å…¸"}},[s._v("#")]),s._v(" 3. å­—å…¸")]),s._v(" "),t("p",[s._v("å­—å…¸ï¼ˆç¬¦å·è¡¨ã€å…³è”æ•°ç»„ã€æ˜ å°„ï¼‰ï¼Œç”¨äºä¿å­˜é”®å€¼å¯¹çš„æŠ½è±¡æ•°æ®ç»“æ„ã€‚")]),s._v(" "),t("h3",{attrs:{id:"_3-1-å®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-å®ç°"}},[s._v("#")]),s._v(" 3.1 å®ç°")]),s._v(" "),t("p",[s._v("Redisçš„å­—å…¸ä½¿ç”¨å“ˆå¸Œè¡¨ä½œä¸ºåº•å±‚å®ç°ï¼Œç”±å“ˆå¸Œè¡¨ã€å“ˆå¸Œè¡¨èŠ‚ç‚¹ã€å­—å…¸ä¸‰ä¸ªç»“æ„ç»„æˆã€‚ä¸€ä¸ªå“ˆå¸Œè¡¨é‡Œé¢å¯ä»¥æœ‰å¤šä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªå“ˆå¸ŒèŠ‚ç‚¹å°±ä¿å­˜äº†å­—å…¸ä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚")]),s._v(" "),t("p",[s._v("ğŸ”¶ "),t("strong",[s._v("å“ˆå¸Œè¡¨")])]),s._v(" "),t("p",[s._v("å“ˆå¸Œè¡¨ä½¿ç”¨"),t("code",[s._v("dict.h/dictht")]),s._v("ç»“æ„è¡¨ç¤º")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("dictht")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å“ˆå¸Œè¡¨æ•°ç»„")]),s._v("\n\tdictEntry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("table"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å“ˆå¸Œè¡¨å¤§å°")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å“ˆå¸Œè¡¨å¤§å°æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ€»æ˜¯ç­‰äºsize-1")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" sizemark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¯¥å“ˆå¸Œè¡¨å·²æœ‰èŠ‚ç‚¹æ•°é‡")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" used"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" dictht"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("tableå±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘dictEntryç»“æ„çš„æŒ‡é’ˆï¼Œæ¯ä¸€ä¸ªdictEntryç»“æ„ä¿æŒç€ä¸€ä¸ªé”®å€¼å¯¹ã€‚")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs/redis-map1.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),s._v(" "),t("p",[s._v("ğŸ”¶ "),t("strong",[s._v("å“ˆå¸Œè¡¨èŠ‚ç‚¹")])]),s._v(" "),t("p",[s._v("å“ˆå¸Œè¡¨ä½¿ç”¨"),t("code",[s._v("dict.h/dictEntry")]),s._v("ç»“æ„è¡¨ç¤ºï¼Œæ¯ä¸ªdictEntryç»“æ„éƒ½ä¿å­˜ç€ä¸€ä¸ªé”®å€¼å¯¹ã€‚")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("dictht")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”®")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å€¼")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("union")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("val"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\tuint64_tu64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\tint64_ts64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" v"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æŒ‡å‘ä¸‹ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå½¢æˆé“¾è¡¨")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("dictEntry")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" dictEntry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("ul",[t("li",[s._v("key ä¿å­˜é”®")]),s._v(" "),t("li",[s._v("value ä¿å­˜å€¼ï¼Œå€¼å¯ä»¥æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªuint64_tæ•´æ•°ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªint64_tæ•´æ•°ã€‚")]),s._v(" "),t("li",[s._v("next æ˜¯æŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œç”¨äºè§£å†³å“ˆå¸Œå†²çªã€‚")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs/redis-map2.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),s._v(" "),t("p",[s._v("ğŸ”¶ "),t("strong",[s._v("å­—å…¸")])]),s._v(" "),t("p",[s._v("å­—å…¸ç”±"),t("code",[s._v("dict.h/dict")]),s._v("ç»“æ„è¡¨ç¤º")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" struc dict "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç±»å‹ç‰¹å®šå‡½æ•°")]),s._v("\n\tdictType "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç§æœ‰æ•°æ®")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("privdata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å“ˆå¸Œè¡¨")]),s._v("\n\tdictht ht"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// rehashç´¢å¼•ï¼ˆæ¸è¿›å¼rehashæ‰©å®¹æ—¶ä½¿ç”¨ï¼Œåé¢ä»‹ç»ï¼‰ï¼Œå½“rehashä¸å†è¿›è¡Œæ—¶ï¼Œå€¼ä¸º-1")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" trehashidx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" dict"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("type å’Œ privdata å±æ€§æ˜¯é’ˆå¯¹ä¸åŒç±»å‹çš„é”®å€¼å¯¹ï¼Œä¸ºåˆ›å»ºå¤šæ€å­—å…¸è€Œè®¾ç½®çš„ã€‚")]),s._v(" "),t("li",[s._v("type å±æ€§æ˜¯ä¸€ä¸ªæŒ‡å‘ dictType ç»“æ„çš„æŒ‡é’ˆï¼Œæ¯ä¸ª dictType ç»“æ„ä¿å­˜äº†ä¸€ç°‡"),t("strong",[s._v("ç”¨äºæ“ä½œç‰¹å®šç±»å‹é”®å€¼å¯¹çš„å‡½æ•°")]),s._v("ï¼ŒRedis ä¼šä¸ºç”¨é€”ä¸åŒçš„å­—å…¸è®¾ç½®ä¸åŒçš„ç±»å‹ç‰¹å®šå‡½æ•°ã€‚")]),s._v(" "),t("li",[s._v("privdata å±æ€§ä¿å­˜éœ€è¦ä¼ ç»™é‚£äº›ç‰¹å®šå‡½æ•°çš„å¯é€‰å‚æ•°ã€‚")])]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" struc dictType "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®¡ç®—å“ˆå¸Œå€¼çš„å‡½æ•°")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("hashFunction"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤åˆ¶é”®çš„å‡½æ•°")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("keyDup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("privdata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤åˆ¶å€¼çš„å‡½æ•°")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("valDup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("privdata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¯¹æ¯”é”®çš„å‡½æ•°")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("keyCompare"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("privdata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("key1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("key2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”€æ¯é”®çš„å‡½æ•°")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("keyDestructor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("privdata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”€æ¯å€¼çš„å‡½æ•°")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("valDestructor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("privdata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" dictType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("â–¶ ht å±æ€§åŒ…å«ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œå­—å…¸åªä½¿ç”¨ ht[0] å“ˆå¸Œè¡¨ï¼Œht[1] å“ˆå¸Œè¡¨åªä¼šåœ¨å¯¹ ht[0] å“ˆå¸Œè¡¨è¿›è¡Œ rehash æ—¶ä½¿ç”¨ã€‚\nâ–¶ rehashidx è®°å½•äº† rehash ç›®å‰çš„è¿›åº¦ï¼Œæ‰©å®¹åˆ°äº†ç¬¬å‡ ä¸ªå€¼ï¼Œå¦‚æœç›®å‰æ²¡æœ‰è¿›è¡Œ rehashï¼Œå€¼ä¸º -1ã€‚")]),s._v(" "),t("p",[s._v("ä¸‹å›¾å±•ç¤ºä¸€ä¸ªæ™®é€šçŠ¶æ€ä¸‹çš„å­—å…¸ï¼ˆæ²¡æœ‰è¿›è¡Œrehashï¼‰ï¼š")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs2023/08/image-20240426201202244.png",alt:"image-20240426201202244"}})]),s._v(" "),t("h3",{attrs:{id:"_3-2-å“ˆå¸Œç®—æ³•"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-å“ˆå¸Œç®—æ³•"}},[s._v("#")]),s._v(" 3.2 å“ˆå¸Œç®—æ³•")]),s._v(" "),t("p",[s._v("å½“è¦å°†ä¸€ä¸ªæ–°çš„é”®å€¼æ·»åŠ åˆ°å­—å…¸é‡Œé¢æ—¶ï¼Œå°±æ˜¯å°†å…¶æ·»åŠ åˆ°ht[0]å“ˆå¸Œè¡¨ä¸­ï¼Œç¨‹åºéœ€è¦æ ¹æ®é”®å€¼å¯¹çš„é”®è®¡ç®—å‡ºå“ˆå¸Œå€¼çš„ç´¢å¼•å€¼ï¼Œæ ¹æ®ç´¢å¼•å€¼ï¼Œå°†åŒ…å«æ–°é”®å€¼å¯¹çš„å“ˆå¸Œè¡¨èŠ‚ç‚¹æ”¾åˆ°å“ˆå¸Œè¡¨æ•°ç»„çš„æŒ‡å®šç´¢å¼•ä¸Šé¢ã€‚")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs/redis-map3.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),s._v(" "),t("p",[s._v("é€šè¿‡é“¾è¡¨æ³•è§£å†³å“ˆå¸Œå†²çªã€‚")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs/redis-map4.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),s._v(" "),t("h3",{attrs:{id:"_3-3-rehash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-rehash"}},[s._v("#")]),s._v(" 3.3 rehash")]),s._v(" "),t("p",[s._v("éšç€æ“ä½œçš„ä¸æ–­è¿›è¡Œï¼Œå“ˆå¸Œè¡¨ä¿å­˜çš„é”®å€¼å¯¹ä¼šé€æ¸åœ°å¢å¤šæˆ–è€…å‡å°‘ï¼Œä¸ºäº†è®©å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­ï¼ˆload factorï¼‰ç»´æŒåœ¨ä¸€ä¸ªåˆç†çš„èŒƒå›´å†…ï¼Œå½“å“ˆå¸Œè¡¨ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡å¤ªå¤šæˆ–è€…å¤ªå°‘æ—¶ï¼Œç¨‹åºéœ€è¦å¯¹å“ˆå¸Œè¡¨çš„å¤§å°è¿›è¡Œæ‰©å±•æˆ–æ”¶ç¼©ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("ä¸ºå­—å…¸çš„ ht[1] å“ˆå¸Œè¡¨åˆ†é…ç©ºé—´ï¼Œht[1] çš„å¤§å°ä¸º"),t("strong",[s._v("ç¬¬ä¸€ä¸ªå¤§äºç­‰äº")]),s._v("\n$$\nht[0].used \\times2^n\n$$")]),s._v(" "),t("li",[s._v("å°†ä¿å­˜åœ¨ ht[0] ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ rehash åˆ° ht[1] ä¸Šé¢ï¼Œå°±æ˜¯é‡æ–°è®¡ç®—é”®çš„å“ˆå¸Œå€¼å’Œç´¢å¼•å€¼ï¼Œå¹¶ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®ã€‚")]),s._v(" "),t("li",[s._v("å½“ ht[0] åŒ…å«çš„æ‰€æœ‰é”®å€¼å¯¹éƒ½è¿ç§»åˆ° ht[1] åï¼ˆht[0]å˜ä¸ºç©ºè¡¨ï¼‰ï¼Œé‡Šæ”¾ ht[0]ï¼Œå°† ht[1] è®¾ç½®ä¸º ht[0]ï¼Œå¹¶åœ¨ ht[1] æ–°åˆ›å»ºä¸€ä¸ªç©ºç™½å“ˆå¸Œè¡¨ï¼Œä¸ºä¸‹ä¸€æ¬¡ rehash åšå‡†å¤‡ã€‚")])]),s._v(" "),t("h3",{attrs:{id:"_3-4-æ¸è¿›å¼rehash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-æ¸è¿›å¼rehash"}},[s._v("#")]),s._v(" 3.4 æ¸è¿›å¼rehash")]),s._v(" "),t("p",[s._v("å¦‚æœ redis çš„å­—å…¸ä¸­ä¿å­˜å¤§é‡é”®å€¼å¯¹ï¼Œè¦ä¸€æ¬¡æ€§å°†è¿™äº›é”®å€¼å¯¹å…¨éƒ¨ rehash åˆ° ht[1] çš„è¯ï¼Œåºå¤§çš„è®¡ç®—å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨åœ¨ä¸€æ®µæ—¶é—´å†…åœæ­¢æœåŠ¡ã€‚å› æ­¤éœ€è¦åˆ†å¤šæ¬¡ã€æ¸è¿›å¼åœ°å°† ht[0] é‡Œé¢çš„é”®å€¼å¯¹æ…¢æ…¢åœ° rehash åˆ° ht[1]ã€‚ä¸‹é¢æ˜¯ rehash çš„æ­¥éª¤ï¼š")]),s._v(" "),t("ol",[t("li",[s._v("ä¸º ht[1] åˆ†é…ç©ºé—´ï¼Œè®©å­—å…¸åŒæ—¶æŒæœ‰ ht[0] å’Œ ht[1] ä¸¤ä¸ªå“ˆå¸Œè¡¨ã€‚")]),s._v(" "),t("li",[s._v("åœ¨å­—å…¸ä¸­ç»´æŒä¸€ä¸ªç´¢å¼•è®¡ç®—å™¨å˜é‡ rehashidxï¼Œå¹¶å°†å®ƒè®¾ç½®ä¸º 0ï¼Œè¡¨ç¤º rehash æ­£å¼å¼€å§‹ã€‚")]),s._v(" "),t("li",[s._v("åœ¨ rehash è¿›è¡ŒæœŸé—´ï¼Œæ¯æ¬¡å¯¹å­—å…¸æ‰§è¡Œæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾æˆ–æ›´æ–°æ“ä½œæ—¶ï¼Œç¨‹åºé™¤äº†æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œä»¥å¤–ï¼Œè¿˜ä¼šé¡ºå¸¦å°† ht[0] åœ¨å“ˆå¸Œè¡¨åœ¨ rehashidx ç´¢å¼•ä¸Šçš„æ‰€æœ‰é”®å€¼å¯¹ rehash åˆ° ht[1]ï¼Œå½“ rehash å·¥ä½œå®Œæˆä¹‹åï¼Œç¨‹åºå°† rehashidx å€¼å¢ä¸€ã€‚")]),s._v(" "),t("li",[s._v("éšç€å­—å…¸æ“ä½œçš„ä¸æ–­æ‰§è¡Œï¼Œæœ€ç»ˆåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œht[0] çš„æ‰€æœ‰é”®å€¼å¯¹éƒ½ä¼šè¢« rehash è‡³ ht[1]ï¼Œè¿™æ—¶ç¨‹åºå°† rehashidx å±æ€§è®¾ç½®ä¸º -1ï¼Œè¡¨ç¤º rehash æ“ä½œå·²å®Œæˆã€‚")])]),s._v(" "),t("p",[s._v("åœ¨æ¸è¿›å¼ rehash è¿‡ç¨‹ä¸­ï¼Œå­—å…¸ä¼šåŒæ—¶ä½¿ç”¨ ht[0] å’Œ ht[1]ï¼Œæ‰€ä»¥å­—å…¸çš„åˆ é™¤ã€æŸ¥æ‰¾ã€æ›´æ–°ç­‰æ“ä½œä¼šåœ¨ä¸¤ä¸ªå“ˆå¸Œè¡¨ä¸Šè¿›ã€‚")]),s._v(" "),t("blockquote",[t("p",[s._v("ä¾‹å¦‚ï¼Œè¦åœ¨å­—å…¸é‡Œé¢æŸ¥æ‰¾ä¸€ä¸ªé”®çš„è¯ï¼Œç¨‹åºä¼šç°åœ¨ht[0]é‡Œé¢æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æ‰¾åˆ°çš„è¯ï¼Œå°±ä¼šç»§ç»­åˆ°ht[1]é‡Œé¢æŸ¥æ‰¾ã€‚")])]),s._v(" "),t("p",[s._v("åœ¨æ¸è¿›å¼ rehash è¿‡ç¨‹ä¸­ï¼Œæ·»åŠ åˆ°å­—å…¸çš„é”®å€¼å¯¹ä¸€å¾‹ä¼šè¢«ä¿å­˜åˆ° ht[1] é‡Œé¢ï¼Œä¿è¯ ht[0] çš„é”®å€¼å¯¹æ•°é‡åªå‡ä¸å¢ã€‚")]),s._v(" "),t("h2",{attrs:{id:"å››ã€è·³è·ƒè¡¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å››ã€è·³è·ƒè¡¨"}},[s._v("#")]),s._v(" å››ã€è·³è·ƒè¡¨")]),s._v(" "),t("p",[s._v("è·³è·ƒè¡¨ï¼ˆskiplistï¼‰æ˜¯ä¸€ç§æœ‰"),t("strong",[s._v("åºæ•°æ®ç»“æ„")]),s._v("ï¼Œå®ƒé€šè¿‡åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ç»´æŒå¤šä¸ªæŒ‡å‘å…¶ä»–èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»è€Œè¾¾åˆ°å¿«é€Ÿè®¿é—®èŠ‚ç‚¹çš„ç›®çš„ã€‚è·³è·ƒè¡¨æ”¯æŒå¹³å‡ O(logN)ã€æœ€å O(N) å¤æ‚åº¦çš„èŠ‚ç‚¹æŸ¥æ‰¾ã€‚")]),s._v(" "),t("p",[s._v("Redis ä½¿ç”¨è·³è·ƒè¡¨ä½œä¸ºæœ‰åºé›†åˆé”®çš„åº•å±‚å®ç°ä¹‹ä¸€ã€‚")]),s._v(" "),t("p",[s._v("è·³è·ƒè¡¨ç”± zskiiplistNode è·³è·ƒè¡¨èŠ‚ç‚¹å’Œ zskiplist è·³è·ƒè¡¨ä¸¤ä¸ªç»“æ„å®šä¹‰ï¼š")]),s._v(" "),t("h3",{attrs:{id:"_4-1-è·³è·ƒè¡¨èŠ‚ç‚¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-è·³è·ƒè¡¨èŠ‚ç‚¹"}},[s._v("#")]),s._v(" 4.1 è·³è·ƒè¡¨èŠ‚ç‚¹")]),s._v(" "),t("p",[s._v("è·³è·ƒè¡¨èŠ‚ç‚¹ç”± "),t("code",[s._v("redis.h/zskiplistNode")]),s._v(" ç»“æ„å®šä¹‰ï¼š")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("zskiplistNode")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å±‚")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("zskiplistLevel")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å‰è¿›æŒ‡é’ˆ")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("zskiplistNode")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("forward"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·¨åº¦")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" span"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" level"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åé€€æŒ‡é’ˆ")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("zskiplistNode")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("backward"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åˆ†å€¼")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("double")]),s._v(" score"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æˆå‘˜å¯¹è±¡")]),s._v("\n\trobj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" zskiplistNode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("ğŸ”¶ å±‚ level[]")]),s._v(" "),t("p",[s._v("è·³è·ƒè¡¨çš„levelæ•°ç»„å¯ä»¥åŒ…å«å¾ˆå¤šå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶ä»–èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡è¿™äº›å±‚æ¥åŠ å¿«è®¿é—®å…¶ä»–èŠ‚ç‚¹çš„é€Ÿåº¦ï¼Œå±‚çš„æ•°é‡è¶Šå¤šè®¿é—®èŠ‚ç‚¹çš„é€Ÿåº¦è¶Šå¿«ã€‚")]),s._v(" "),t("p",[s._v("æ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°è·³è·ƒè¡¨èŠ‚ç‚¹çš„æ—¶å€™ï¼Œç¨‹åºéƒ½æ ¹æ®å¹‚æ¬¡å®šå¾‹éšæœºç”Ÿæˆä¸€ä¸ªä»‹äº1å’Œ32ä¹‹é—´çš„å€¼ä½œä¸ºlevelæ•°ç»„çš„å¤§å°ã€‚")]),s._v(" "),t("p",[s._v("ğŸ”¶ å‰è¿›æŒ‡é’ˆ forward")]),s._v(" "),t("p",[s._v("æ¯ä¸ªå±‚éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘è¡¨å°¾æ–¹å‘çš„å‰è¿›æŒ‡é’ˆ"),t("code",[s._v("level[i].forward")])]),s._v(" "),t("p",[s._v("ğŸ”¶ è·¨åº¦ span")]),s._v(" "),t("p",[s._v("å±‚çš„è·¨åº¦"),t("code",[s._v("level[i].span")]),s._v("ç”¨äºè®°å½•ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚è·¨åº¦å¹¶ä¸æ˜¯ç”¨äºéå†æ“ä½œï¼Œè€Œæ˜¯ç”¨äºè®¡ç®—æ’ä½çš„ï¼Œåœ¨æŸ¥æ‰¾æŸä¸€ä¸ªèŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ²¿é€”è®¿é—®è¿‡çš„æ‰€æœ‰å±‚çš„è·¨åº¦ç´¯è®¡èµ·æ¥ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯ç›®æ ‡èŠ‚ç‚¹åœ¨è·³è·ƒè¡¨ä¸­çš„æ’ä½ã€‚")]),s._v(" "),t("p",[s._v("ğŸ”¶ åé€€æŒ‡é’ˆ backward")]),s._v(" "),t("p",[s._v("ç”¨äºä»è¡¨å°¾å‘è¡¨å¤´æ–¹å‘è®¿é—®èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªåé€€æŒ‡é’ˆï¼Œæ¯æ¬¡åªèƒ½åé€€è‡³å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚")]),s._v(" "),t("p",[s._v("ğŸ”¶ åˆ†å€¼ score å’Œæˆå‘˜ obj")]),s._v(" "),t("p",[s._v("åˆ†å€¼ï¼šdouble ç±»å‹ï¼Œè·³è·ƒè¡¨ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æŒ‰åˆ†æ”¯ä»å°åˆ°å¤§æ’åºã€‚")]),s._v(" "),t("p",[s._v("æˆå‘˜å¯¹è±¡ï¼šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªSDSå­—ç¬¦ä¸²å¯¹è±¡ã€‚å„ä¸ªèŠ‚ç‚¹ä¿å­˜çš„æˆå‘˜å¯¹è±¡å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œåˆ†å€¼ç›¸åŒçš„èŠ‚ç‚¹æŒ‰æˆå‘˜å¯¹è±¡åœ¨å­—å…¸åºä¸­çš„å¤§å°æ¥è¿›è¡Œæ’åºã€‚")]),s._v(" "),t("h3",{attrs:{id:"_4-2-è·³è·ƒè¡¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-è·³è·ƒè¡¨"}},[s._v("#")]),s._v(" 4.2 è·³è·ƒè¡¨")]),s._v(" "),t("p",[s._v("è·³è·ƒè¡¨ç”±"),t("code",[s._v("redis.h/zskiplist")]),s._v("ç»“æ„å®šä¹‰ï¼š")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("zskiplist")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("skiplistNode")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("tail"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unsigned")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¡¨ä¸­æ•°é‡æœ€å¤§çš„èŠ‚ç‚¹çš„å±‚æ•°")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" level"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("headerå’ŒtailæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘è·³è·ƒè¡¨çš„è¡¨å¤´å’Œè¡¨å°¾èŠ‚ç‚¹ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªæŒ‡é’ˆï¼Œç¨‹åºå®šä½è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹çš„å¤æ‚åº¦å°¾O(1)ã€‚")]),s._v(" "),t("p",[s._v("è·³è·ƒè¡¨ç»“æ„å¦‚ä¸‹å›¾ï¼š")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/zouquchen/Images/main/imgs/redis-zskiplist1.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})])])}),[],!1,null,null,null);t.default=e.exports}}]);